import React, { createContext, useContext, useMemo, useState } from "react";

export type Locale = "zh" | "en";

type MessageTree = Record<string, MessageTree | string>;

const messages: Record<Locale, MessageTree> = {
  zh: {
    nav: {
      projects: "项目",
      themes: "主题",
      algorithms: "算法",
      backtests: "回测",
      reports: "报告",
      data: "数据",
      audit: "审计",
    },
    app: {
      footer: "本地化量化平台 · Lean 引擎",
    },
    topbar: {
      localRunner: "本地执行器",
      leanEngine: "Lean 引擎",
      switchLanguage: "切换语言",
      localeShort: {
        zh: "中文",
        en: "EN",
      },
    },
    common: {
      none: "-",
      noneText: "无",
      status: {
        queued: "排队中",
        running: "运行中",
        success: "成功",
        failed: "失败",
        ok: "正常",
        warn: "警告",
      },
      actions: {
        create: "创建",
        save: "保存",
        saveVersion: "保存版本",
        start: "开始",
        compare: "开始对比",
        generateDiff: "生成 diff",
        run: "运行回测",
        view: "查看",
        download: "下载",
        query: "查询",
        syncAll: "同步全部",
        scan: "执行扫描",
        loadCharts: "加载图表",
      },
      labels: {
        status: "状态",
        createdAt: "创建时间",
        updatedAt: "更新时间",
        endedAt: "结束时间",
      },
    },
    metrics: {
      cagr: "复合年化收益率（CAGR）",
      drawdown: "最大回撤",
      sharpe: "夏普比率",
      netProfit: "净收益",
      totalFees: "总手续费",
      turnover: "组合换手率",
      riskStatus: "风控状态",
    },
    charts: {
      noData: "暂无数据",
      pointsSummary: "点数 {count}，起点 {start}，终点 {end}",
      equityCurve: "权益曲线（Strategy Equity）",
      drawdownCurve: "回撤曲线（Drawdown）",
    },
    projects: {
      title: "项目管理",
      new: {
        title: "新建项目",
        meta: "用于组织算法与回测记录",
        name: "项目名称",
        description: "项目描述",
        errorName: "请输入项目名称",
      },
      overview: {
        title: "项目概览",
        meta: "当前项目数量",
      },
      table: {
        project: "项目",
        description: "描述",
        createdAt: "创建时间",
      },
      config: {
        title: "项目配置",
        meta: "配置成分范围、数据源与权重",
        universeMode: "成分范围",
        universeHistory: "历史成分（含退市）",
        universeCurrent: "当前成分",
        frequency: "数据周期",
        frequencyDaily: "日线",
        frequencyMinute: "分钟（需付费数据）",
        vendorPrimary: "主数据源",
        vendorFallback: "备数据源",
        benchmark: "基准",
        rebalance: "调仓频率",
        rebalanceDaily: "每日",
        rebalanceWeekly: "每周",
        rebalanceMonthly: "每月",
        rebalanceQuarterly: "每季",
        weights: "主题权重",
        themesTitle: "主题配置",
        themesEmpty: "暂无主题，请先添加",
        themeKey: "主题编码",
        themeLabel: "主题名称",
        themeWeight: "权重",
        themeKeywords: "关键词（逗号分隔）",
        themeManual: "手动股票（逗号分隔）",
        themeManualShort: "手动股票",
        themeAdd: "添加主题",
        themeRemove: "删除主题",
        themeHint: "关键词用于 Yahoo 搜索；手动股票会优先纳入。",
        themeDuplicate: "主题编码重复，请修改后再保存",
        themeActions: "操作",
        themeCount: "主题数量",
        themeSummaryError: "主题构成读取失败",
        themeTotalSymbols: "覆盖股票数",
        themeComposition: "主题构成",
        themeSymbolCount: "股票数量",
        themeSample: "样例股票",
        themeDistribution: "主题分布",
        themeWeightDistribution: "权重分布",
        themeExpand: "展开",
        themeCollapse: "收起",
        themeEmptySymbols: "暂无股票",
        themeView: "查看详情",
        themeClose: "收起详情",
        themeFilter: "主题过滤",
        themeFilterPlaceholder: "按主题名称或编码筛选",
        themeSearchSymbol: "股票筛选",
        themeSearchPlaceholder: "输入股票代码（例如 AAPL）",
        themeSearchHint: "输入股票代码后筛选对应主题",
        themeSearchClear: "清除筛选",
        themeSearchEmpty: "请输入股票代码后再筛选",
        themeSearchError: "股票筛选失败",
        themeSearchMatches: "匹配主题 {count} 个",
        themeDetailTitle: "主题详情 · {name}",
        themeDetailMeta: "共 {total} 只股票（手动 {manual}）",
        themeDetailFilter: "筛选主题内股票（支持代码包含）",
        themeDetailClear: "清除",
        themeDetailExport: "导出列表",
        themeCompareTitle: "主题对比",
        themeCompareA: "主题 A",
        themeCompareB: "主题 B",
        themeCompareEmpty: "请选择主题",
        themeCompareShared: "交集",
        themeCompareOnlyA: "仅主题 A",
        themeCompareOnlyB: "仅主题 B",
        themeCompareError: "主题对比加载失败",
        includeHistory: "包含历史成分",
        riskFreeRate: "无风险利率",
        sectionUniverse: "成分范围",
        sectionData: "数据源",
        sectionThemes: "主题",
        sectionPortfolio: "组合",
        themeMovedHint: "主题管理已迁移到「主题」页面",
        weightTotal: "权重合计",
        source: "配置来源",
        save: "保存配置",
        saved: "配置已保存",
        error: "保存失败，请检查配置",
      },
      dataStatus: {
        title: "数据状态",
        meta: "S&P500 历史成分与主题数据概况",
        membership: "历史成分数量",
        range: "历史区间",
        universe: "联合成分数量",
        themes: "主题类别数",
        metrics: "指标快照数量",
        prices: "价格文件数量",
        root: "数据根目录",
        action: "刷新数据",
        queued: "已提交数据刷新任务",
        error: "刷新失败，请检查日志",
      },
      algorithm: {
        title: "算法绑定",
        meta: "选择项目使用的算法版本",
        algorithm: "算法",
        version: "算法版本",
        selectAlgorithm: "选择算法",
        selectVersion: "选择版本",
        lock: "锁定算法版本",
        current: "当前绑定",
        save: "保存绑定",
        saved: "算法绑定已保存",
        error: "算法绑定失败",
        errorSelect: "请选择算法与版本",
      },
      backtest: {
        title: "主题回测",
        meta: "基于 S&P500 + AI 主题权重的组合回测",
        action: "运行回测",
        queued: "已提交回测任务",
        empty: "暂无回测结果",
        error: "回测触发失败",
        metric: "指标",
        portfolio: "组合",
        benchmark: "基准",
        metrics: {
          cagr: "年化收益",
          volatility: "波动率",
          sharpe: "夏普比率",
          maxDrawdown: "最大回撤",
        },
      },
      versions: {
        title: "版本管理",
        meta: "记录项目描述或关键配置快照",
        emptyProject: "暂无项目",
        version: "版本号 (v0.1)",
        description: "版本说明",
        content: "内容快照（默认使用当前项目描述：{description}）",
        errorSelect: "请先选择项目",
        errorContent: "请填写版本号或内容快照",
      },
      diff: {
        title: "版本对比",
        meta: "选择两个版本生成差异",
        selectFrom: "选择旧版本",
        selectTo: "选择新版本",
        errorSelect: "请选择两个版本进行对比",
        empty: "无差异",
        none: "尚未生成 diff",
      },
      versionsTable: {
        id: "版本 ID",
        version: "版本号",
        summary: "摘要",
        hash: "Hash",
        createdAt: "创建时间",
        empty: "暂无版本记录",
        unnamed: "未命名",
      },
    },
    themes: {
      title: "主题管理",
      project: {
        title: "项目选择",
        meta: "选择项目后管理主题结构与权重",
        select: "当前项目",
        name: "项目名称",
        description: "项目描述",
        configSource: "配置来源",
        empty: "请选择项目后继续",
      },
      config: {
        title: "主题配置",
        meta: "维护主题权重、关键词与手动股票",
      },
      composition: {
        title: "主题构成",
        meta: "查看主题覆盖与股票组成",
      },
      compare: {
        meta: "对比主题交集与差集",
      },
    },
    algorithms: {
      title: "算法管理",
      register: {
        title: "登记算法",
        meta: "用于管理策略版本与执行入口",
        name: "算法名称",
        description: "算法说明",
        language: "语言 (Python/CSharp)",
        version: "版本 (v1.0.0)",
        path: "算法文件路径（/app/stocklean/algorithms/xxx.py）",
        typeName: "C# 类型名（可选）",
        errorName: "请输入算法名称",
      },
      overview: {
        title: "算法概览",
        meta: "当前已登记数量",
      },
      table: {
        name: "名称",
        language: "语言",
        version: "版本",
        path: "路径",
        updatedAt: "更新时间",
      },
      versions: {
        title: "版本管理",
        meta: "为算法登记版本快照并生成对比",
        empty: "暂无算法",
        version: "版本号 (v1.0.1)",
        description: "版本说明",
        language: "语言（默认 {language}）",
        typeName: "C# 类型名（可选）",
        filePath: "算法文件路径（留空则使用内容）",
        content: "算法内容（可选，用于生成 diff）",
        errorSelect: "请先选择算法",
        errorContent: "请至少填写版本号或文件路径/内容",
      },
      projectCreate: {
        title: "从算法创建项目",
        meta: "将指定版本作为项目模板",
        name: "项目名称",
        description: "项目描述",
        version: "算法版本",
        lock: "锁定版本",
        action: "创建项目",
        success: "项目已创建并绑定算法",
        error: "创建失败，请检查输入",
        errorSelect: "请选择算法版本",
      },
      diff: {
        title: "版本对比",
        meta: "选择两个版本生成差异",
        selectFrom: "选择旧版本",
        selectTo: "选择新版本",
        errorSelect: "请选择两个版本进行对比",
        empty: "无差异",
        none: "尚未生成 diff",
        unnamed: "未命名",
      },
      versionsTable: {
        id: "版本 ID",
        version: "版本号",
        summary: "摘要",
        hash: "Hash",
        createdAt: "创建时间",
        empty: "暂无版本记录",
      },
    },
    backtests: {
      title: "回测中心",
      launch: {
        title: "发起回测",
        meta: "填写项目 ID 与参数",
        projectId: "项目 ID",
        params: "参数 JSON",
      },
      table: {
        id: "ID",
        project: "项目",
        status: "状态",
        report: "报告",
        createdAt: "创建时间",
        endedAt: "结束时间",
      },
    },
    reports: {
      title: "报告中心",
      latest: {
        title: "最新报告",
        meta: "回测运行后自动归档",
      },
      preview: {
        title: "报告预览",
        meta: "在页面内查看回测 HTML 报告",
        open: "新窗口打开",
        empty: "请选择报告进行预览",
      },
      risk: {
        title: "公司行为风险提示",
        meta:
          "复权与更名映射依赖 map_files/factor_files。缺失时可能导致历史价格断裂或回测误差。",
      },
      compare: {
        title: "回测对比",
        meta: "输入多个回测 ID，快速横向比较关键指标",
        placeholder: "例如：2, 15, 18",
        error: "对比失败",
        empty: "请输入回测 ID（逗号或空格分隔）",
      },
      charts: {
        title: "图表预览",
        meta: "输入回测 ID，加载收益曲线与回撤曲线",
        placeholder: "回测 ID",
        errorNotFound: "未找到结果文件，请确认回测已完成",
        errorLoad: "读取图表失败",
      },
      table: {
        id: "ID",
        runId: "回测 ID",
        type: "类型",
        path: "路径",
        actions: "操作",
        createdAt: "生成时间",
      },
    },
    data: {
      title: "数据管理",
      coverage: {
        title: "数据覆盖",
        meta: "数据层更新与质量监控",
      },
      fetch: {
        title: "历史数据抓取",
        meta: "默认 Stooq，快速拉取日线历史数据",
        symbol: "股票代码（如 AAPL）",
        vendor: {
          stooq: "Stooq（默认）",
        },
        region: {
          us: "美股",
          hk: "港股",
        },
        asset: {
          equity: "股票",
          etf: "ETF",
        },
        frequency: {
          daily: "日线",
          minute: "分钟（暂不支持）",
        },
        preview: "将创建数据集 {dataset} · 来源 {source}",
        action: "抓取历史",
        loading: "抓取中",
        hint: "Stooq 仅支持日线，系统会自动发起数据同步任务",
        errorSymbol: "请填写股票代码",
        errorFrequency: "Stooq 仅支持日线数据",
        error: "历史数据抓取失败",
        successCreated: "已创建数据集 {name}，同步任务 #{jobId} 已排队",
        successQueued: "已复用数据集 {name}，同步任务 #{jobId} 已排队",
        successNoJob: "已准备数据集 {name}",
      },
      list: {
        title: "数据集列表",
        meta: "当前筛选 {totalSymbols} 只股票 / {totalDatasets} 个数据集 · 支持日线/分钟",
        empty: "暂无数据集",
        filter: {
          label: "周期筛选",
          all: "全部",
          daily: "日线",
          minute: "分钟",
        },
        update: {
          sync: "更新",
          syncing: "更新中",
          syncAll: "全部更新",
          syncingAll: "更新中",
        },
        delete: {
          action: "删除",
          deleting: "删除中",
          confirm: "确认删除 {symbol} 的全部数据？该操作不可撤销。",
          prompt: "请输入 {symbol} 以确认删除",
          mismatch: "输入不匹配，已取消删除",
          error: "删除失败",
        },
        quality: {
          loading: "加载中",
          error: "质量异常",
          days: "天",
          issues: "问题 {count}",
        },
        table: {
          symbol: "Symbol",
          name: "名称",
          periods: "周期/区间",
          frequency: "周期",
          coverage: "覆盖区间",
          updatedAt: "更新时间",
          source: "来源",
          quality: "质量",
          update: "更新",
          actions: "操作",
        },
      },
      frequency: {
        daily: "日线",
        minute: "分钟",
      },
      register: {
        title: "登记数据集",
        meta: "记录来源、频率与覆盖区间",
        name: "数据集名称",
        vendor: "供应商 (Stooq/Yahoo/自建)",
        frequency: "频率 (daily/minute)",
        asset: "资产类别 (Equity/ETF)",
        region: "区域 (US/HK)",
        start: "覆盖开始 (YYYY-MM-DD)",
        end: "覆盖结束 (YYYY-MM-DD)",
        path: "默认数据路径（DATA_ROOT 内或 stooq:SYMBOL）",
        errorName: "请输入数据集名称",
      },
      table: {
        name: "名称",
        vendor: "供应商",
        frequency: "频率",
        coverage: "覆盖区间",
        path: "路径",
        quality: "质量",
        updatedAt: "更新时间",
      },
      quality: {
        error: "获取质量报告失败",
        title: "质量报告",
        status: "状态",
        coverage: "覆盖区间",
        days: "覆盖天数",
        frequency: "频率",
        expected: "预计数据点",
        issues: "问题",
      },
      scan: {
        title: "质量扫描（缺失/异常）",
        meta: "输入 CSV 路径并执行扫描",
        select: "选择数据集",
        errorSelect: "请选择数据集",
        filePath: "CSV 文件路径（位于 DATA_ROOT 内）",
        errorFilePath: "请输入数据文件路径",
        dateColumn: "日期列名",
        closeColumn: "收盘价列名",
        frequency: "频率覆盖 (daily/minute)",
        error: "质量扫描失败",
        result: "扫描结果",
        totalRows: "总行数",
        missingDays: "缺失交易日",
        missingRatio: "缺失比例",
        nullClose: "空收盘价记录",
        duplicate: "重复时间戳",
        outliers: "异常收益数",
        maxAbs: "最大绝对收益",
      },
      sync: {
        title: "数据更新（补齐/增量）",
        meta: "扫描路径并更新覆盖区间",
        path: "数据路径（可留空，或 stooq:SYMBOL）",
        dateColumn: "日期列名",
        errorCreate: "更新任务创建失败",
        errorBatch: "批量更新失败",
      },
      jobs: {
        title: "更新任务",
        meta: "共 {total} 条同步任务",
        empty: "暂无更新任务",
        id: "ID",
        dataset: "数据集",
        status: "状态",
        rows: "扫描行数",
        coverage: "覆盖区间",
        outputs: "输出/归档",
        message: "消息",
        createdAt: "创建时间",
        outputLabels: {
          curated: "curated",
          normalized: "normalized",
          adjusted: "adjusted",
          snapshot: "snapshot",
          lean: "lean",
          leanAdjusted: "lean(adj)",
        },
      },
    },
    pagination: {
      prev: "上一页",
      next: "下一页",
      page: "第 {page} / {pages} 页",
      total: "共 {total} 条",
      range: "显示 {start}-{end}",
      pageSize: "每页",
    },
    audit: {
      title: "审计日志",
      filters: {
        title: "筛选条件",
        meta: "支持 action / resource_type / resource_id",
        action: "action (backtest.create)",
        resourceType: "resource_type (dataset)",
        resourceId: "resource_id (数字)",
      },
      table: {
        id: "ID",
        time: "时间",
        action: "动作",
        resource: "资源",
        detail: "详情",
        empty: "暂无审计记录",
      },
    },
  },
  en: {
    nav: {
      projects: "Projects",
      themes: "Themes",
      algorithms: "Algorithms",
      backtests: "Backtests",
      reports: "Reports",
      data: "Data",
      audit: "Audit Logs",
    },
    app: {
      footer: "Local Quant Platform · Lean Engine",
    },
    topbar: {
      localRunner: "Local Runner",
      leanEngine: "Lean Engine",
      switchLanguage: "Switch Language",
      localeShort: {
        zh: "中文",
        en: "EN",
      },
    },
    common: {
      none: "-",
      noneText: "None",
      status: {
        queued: "Queued",
        running: "Running",
        success: "Success",
        failed: "Failed",
        ok: "OK",
        warn: "Warning",
      },
      actions: {
        create: "Create",
        save: "Save",
        saveVersion: "Save Version",
        start: "Start",
        compare: "Compare",
        generateDiff: "Generate Diff",
        run: "Run Backtest",
        view: "View",
        download: "Download",
        query: "Search",
        syncAll: "Sync All",
        scan: "Run Scan",
        loadCharts: "Load Charts",
      },
      labels: {
        status: "Status",
        createdAt: "Created At",
        updatedAt: "Updated At",
        endedAt: "Ended At",
      },
    },
    metrics: {
      cagr: "CAGR",
      drawdown: "Max Drawdown",
      sharpe: "Sharpe Ratio",
      netProfit: "Net Profit",
      totalFees: "Total Fees",
      turnover: "Portfolio Turnover",
      riskStatus: "Risk Status",
    },
    charts: {
      noData: "No data available",
      pointsSummary: "Points {count}, start {start}, end {end}",
      equityCurve: "Equity Curve (Strategy Equity)",
      drawdownCurve: "Drawdown Curve (Drawdown)",
    },
    projects: {
      title: "Project Management",
      new: {
        title: "New Project",
        meta: "Organize algorithms and backtest runs.",
        name: "Project Name",
        description: "Project Description",
        errorName: "Project name is required.",
      },
      overview: {
        title: "Project Overview",
        meta: "Total projects",
      },
      table: {
        project: "Project",
        description: "Description",
        createdAt: "Created At",
      },
      config: {
        title: "Project Config",
        meta: "Universe scope, data sources, and weights",
        universeMode: "Universe Scope",
        universeHistory: "Historical constituents",
        universeCurrent: "Current constituents",
        frequency: "Data Frequency",
        frequencyDaily: "Daily",
        frequencyMinute: "Minute (paid data)",
        vendorPrimary: "Primary Source",
        vendorFallback: "Fallback Source",
        benchmark: "Benchmark",
        rebalance: "Rebalance Frequency",
        rebalanceDaily: "Daily",
        rebalanceWeekly: "Weekly",
        rebalanceMonthly: "Monthly",
        rebalanceQuarterly: "Quarterly",
        weights: "Theme Weights",
        themesTitle: "Themes",
        themesEmpty: "No themes yet. Add one to continue.",
        themeKey: "Theme Key",
        themeLabel: "Theme Name",
        themeWeight: "Weight",
        themeKeywords: "Keywords (comma-separated)",
        themeManual: "Manual Symbols (comma-separated)",
        themeManualShort: "Manual Symbols",
        themeAdd: "Add Theme",
        themeRemove: "Remove",
        themeHint: "Keywords drive Yahoo search; manual symbols are always included.",
        themeDuplicate: "Duplicate theme keys. Please fix before saving.",
        themeActions: "Actions",
        themeCount: "Themes",
        themeSummaryError: "Failed to load theme summary.",
        themeTotalSymbols: "Total Symbols",
        themeComposition: "Theme Composition",
        themeSymbolCount: "Symbols",
        themeSample: "Sample Symbols",
        themeDistribution: "Distribution",
        themeWeightDistribution: "Weight Split",
        themeExpand: "Expand",
        themeCollapse: "Collapse",
        themeEmptySymbols: "No symbols",
        themeView: "View",
        themeClose: "Hide",
        themeFilter: "Theme Filter",
        themeFilterPlaceholder: "Filter by theme name or key",
        themeSearchSymbol: "Symbol Filter",
        themeSearchPlaceholder: "Enter a symbol (e.g., AAPL)",
        themeSearchHint: "Filter themes by stock symbol",
        themeSearchClear: "Clear",
        themeSearchEmpty: "Enter a symbol to filter.",
        themeSearchError: "Symbol filter failed.",
        themeSearchMatches: "{count} themes matched",
        themeDetailTitle: "Theme Detail · {name}",
        themeDetailMeta: "{total} symbols (manual {manual})",
        themeDetailFilter: "Filter symbols in theme",
        themeDetailClear: "Clear",
        themeDetailExport: "Export",
        themeCompareTitle: "Theme Comparison",
        themeCompareA: "Theme A",
        themeCompareB: "Theme B",
        themeCompareEmpty: "Select a theme",
        themeCompareShared: "Overlap",
        themeCompareOnlyA: "Only A",
        themeCompareOnlyB: "Only B",
        themeCompareError: "Failed to load comparison data.",
        includeHistory: "Include historical constituents",
        riskFreeRate: "Risk-free rate",
        sectionUniverse: "Universe",
        sectionData: "Data",
        sectionThemes: "Themes",
        sectionPortfolio: "Portfolio",
        themeMovedHint: "Theme management moved to the Themes page.",
        weightTotal: "Weight Total",
        source: "Config Source",
        save: "Save Config",
        saved: "Config saved",
        error: "Save failed. Check config.",
      },
      dataStatus: {
        title: "Data Status",
        meta: "S&P500 history and theme coverage",
        membership: "Historical constituents",
        range: "History range",
        universe: "Combined universe",
        themes: "Theme categories",
        metrics: "Metrics snapshots",
        prices: "Price files",
        root: "Data root",
        action: "Refresh Data",
        queued: "Refresh queued",
        error: "Refresh failed",
      },
      algorithm: {
        title: "Algorithm Binding",
        meta: "Select the algorithm version for this project",
        algorithm: "Algorithm",
        version: "Version",
        selectAlgorithm: "Select algorithm",
        selectVersion: "Select version",
        lock: "Lock algorithm version",
        current: "Current binding",
        save: "Save binding",
        saved: "Binding saved",
        error: "Binding failed",
        errorSelect: "Select algorithm and version",
      },
      backtest: {
        title: "Thematic Backtest",
        meta: "S&P500 + AI theme weighted portfolio",
        action: "Run Backtest",
        queued: "Backtest queued",
        empty: "No backtest result",
        error: "Backtest trigger failed",
        metric: "Metric",
        portfolio: "Portfolio",
        benchmark: "Benchmark",
        metrics: {
          cagr: "CAGR",
          volatility: "Volatility",
          sharpe: "Sharpe",
          maxDrawdown: "Max Drawdown",
        },
      },
      versions: {
        title: "Version Management",
        meta: "Capture project notes or configuration snapshots.",
        emptyProject: "No projects yet",
        version: "Version (v0.1)",
        description: "Version Notes",
        content: "Content snapshot (default: {description})",
        errorSelect: "Select a project first.",
        errorContent: "Provide a version or content snapshot.",
      },
      diff: {
        title: "Version Diff",
        meta: "Select two versions to compare.",
        selectFrom: "Select base version",
        selectTo: "Select target version",
        errorSelect: "Select two versions to compare.",
        empty: "No differences",
        none: "No diff generated yet",
      },
      versionsTable: {
        id: "Version ID",
        version: "Version",
        summary: "Summary",
        hash: "Hash",
        createdAt: "Created At",
        empty: "No versions yet",
        unnamed: "Unnamed",
      },
    },
    themes: {
      title: "Theme Studio",
      project: {
        title: "Project Scope",
        meta: "Select a project to manage themes",
        select: "Active Project",
        name: "Project Name",
        description: "Description",
        configSource: "Config Source",
        empty: "Select a project to continue",
      },
      config: {
        title: "Theme Configuration",
        meta: "Manage weights, keywords, and manual symbols",
      },
      composition: {
        title: "Theme Composition",
        meta: "Review coverage and constituent symbols",
      },
      compare: {
        meta: "Compare overlaps and deltas",
      },
    },
    algorithms: {
      title: "Algorithm Management",
      register: {
        title: "Register Algorithm",
        meta: "Manage strategy versions and execution entrypoints.",
        name: "Algorithm Name",
        description: "Description",
        language: "Language (Python/CSharp)",
        version: "Version (v1.0.0)",
        path: "Algorithm file path (/app/stocklean/algorithms/xxx.py)",
        typeName: "C# type name (optional)",
        errorName: "Algorithm name is required.",
      },
      overview: {
        title: "Algorithm Overview",
        meta: "Total registered",
      },
      table: {
        name: "Name",
        language: "Language",
        version: "Version",
        path: "Path",
        updatedAt: "Updated At",
      },
      versions: {
        title: "Version Management",
        meta: "Capture algorithm snapshots and diffs.",
        empty: "No algorithms yet",
        version: "Version (v1.0.1)",
        description: "Version Notes",
        language: "Language (default {language})",
        typeName: "C# type name (optional)",
        filePath: "Algorithm file path (leave empty to use content)",
        content: "Algorithm content (optional, for diff)",
        errorSelect: "Select an algorithm first.",
        errorContent: "Provide a version or file path/content.",
      },
      projectCreate: {
        title: "Create Project",
        meta: "Use a version as a project template.",
        name: "Project name",
        description: "Project description",
        version: "Algorithm version",
        lock: "Lock version",
        action: "Create project",
        success: "Project created and bound",
        error: "Create failed. Check inputs.",
        errorSelect: "Select an algorithm version",
      },
      diff: {
        title: "Version Diff",
        meta: "Select two versions to compare.",
        selectFrom: "Select base version",
        selectTo: "Select target version",
        errorSelect: "Select two versions to compare.",
        empty: "No differences",
        none: "No diff generated yet",
        unnamed: "Unnamed",
      },
      versionsTable: {
        id: "Version ID",
        version: "Version",
        summary: "Summary",
        hash: "Hash",
        createdAt: "Created At",
        empty: "No versions yet",
      },
    },
    backtests: {
      title: "Backtest Center",
      launch: {
        title: "Launch Backtest",
        meta: "Provide project ID and parameters.",
        projectId: "Project ID",
        params: "Parameters JSON",
      },
      table: {
        id: "ID",
        project: "Project",
        status: "Status",
        report: "Report",
        createdAt: "Created At",
        endedAt: "Ended At",
      },
    },
    reports: {
      title: "Report Center",
      latest: {
        title: "Latest Reports",
        meta: "Auto-archived after backtest runs.",
      },
      preview: {
        title: "Report Preview",
        meta: "View backtest HTML report inline.",
        open: "Open in new tab",
        empty: "Select a report to preview.",
      },
      risk: {
        title: "Corporate Actions Risk",
        meta:
          "Adjustments and ticker mapping rely on map_files/factor_files. Missing data can break price history and distort backtests.",
      },
      compare: {
        title: "Backtest Comparison",
        meta: "Enter multiple backtest IDs to compare key metrics.",
        placeholder: "e.g. 2, 15, 18",
        error: "Comparison failed",
        empty: "Enter backtest IDs (comma or space separated).",
      },
      charts: {
        title: "Chart Preview",
        meta: "Enter a backtest ID to load equity and drawdown curves.",
        placeholder: "Backtest ID",
        errorNotFound: "Result file not found. Ensure the backtest finished.",
        errorLoad: "Failed to load chart data",
      },
      table: {
        id: "ID",
        runId: "Backtest ID",
        type: "Type",
        path: "Path",
        actions: "Actions",
        createdAt: "Created At",
      },
    },
    data: {
      title: "Data Management",
      coverage: {
        title: "Coverage",
        meta: "Data sync and quality monitoring.",
      },
      fetch: {
        title: "Fetch History",
        meta: "Default to Stooq for daily backfills.",
        symbol: "Symbol (e.g., AAPL)",
        vendor: {
          stooq: "Stooq (default)",
        },
        region: {
          us: "US",
          hk: "HK",
        },
        asset: {
          equity: "Equity",
          etf: "ETF",
        },
        frequency: {
          daily: "Daily",
          minute: "Minute (unsupported)",
        },
        preview: "Dataset {dataset} · Source {source}",
        action: "Fetch History",
        loading: "Fetching",
        hint: "Stooq supports daily data only; a sync job will be queued.",
        errorSymbol: "Symbol is required.",
        errorFrequency: "Stooq supports daily data only.",
        error: "Fetch failed.",
        successCreated: "Created {name}, sync job #{jobId} queued.",
        successQueued: "Reused {name}, sync job #{jobId} queued.",
        successNoJob: "Dataset {name} ready.",
      },
      list: {
        title: "Datasets",
        meta: "Filtered {totalSymbols} symbols / {totalDatasets} datasets · Daily/Minute supported",
        empty: "No datasets",
        filter: {
          label: "Frequency",
          all: "All",
          daily: "Daily",
          minute: "Minute",
        },
        update: {
          sync: "Sync",
          syncing: "Syncing",
          syncAll: "Sync All",
          syncingAll: "Syncing",
        },
        delete: {
          action: "Delete",
          deleting: "Deleting",
          confirm: "Delete all data for {symbol}? This cannot be undone.",
          prompt: "Type {symbol} to confirm deletion",
          mismatch: "Input does not match. Deletion cancelled.",
          error: "Delete failed",
        },
        quality: {
          loading: "Loading",
          error: "Quality error",
          days: "d",
          issues: "Issues {count}",
        },
        table: {
          symbol: "Symbol",
          name: "Name",
          periods: "Periods",
          frequency: "Frequency",
          coverage: "Coverage",
          updatedAt: "Updated",
          source: "Source",
          quality: "Quality",
          update: "Update",
          actions: "Actions",
        },
      },
      frequency: {
        daily: "Daily",
        minute: "Minute",
      },
      register: {
        title: "Register Dataset",
        meta: "Record source, frequency, and coverage window.",
        name: "Dataset Name",
        vendor: "Vendor (Stooq/Yahoo/Custom)",
        frequency: "Frequency (daily/minute)",
        asset: "Asset Class (Equity/ETF)",
        region: "Region (US/HK)",
        start: "Coverage Start (YYYY-MM-DD)",
        end: "Coverage End (YYYY-MM-DD)",
        path: "Default data path (under DATA_ROOT or stooq:SYMBOL)",
        errorName: "Dataset name is required.",
      },
      table: {
        name: "Name",
        vendor: "Vendor",
        frequency: "Frequency",
        coverage: "Coverage",
        path: "Path",
        quality: "Quality",
        updatedAt: "Updated At",
      },
      quality: {
        error: "Failed to fetch quality report",
        title: "Quality Report",
        status: "Status",
        coverage: "Coverage",
        days: "Coverage Days",
        frequency: "Frequency",
        expected: "Expected Points",
        issues: "Issues",
      },
      scan: {
        title: "Quality Scan (Missing/Anomalies)",
        meta: "Provide a CSV path and run scan.",
        select: "Select Dataset",
        errorSelect: "Select a dataset.",
        filePath: "CSV file path (under DATA_ROOT)",
        errorFilePath: "Provide a data file path.",
        dateColumn: "Date column",
        closeColumn: "Close column",
        frequency: "Frequency (daily/minute)",
        error: "Quality scan failed",
        result: "Scan Results",
        totalRows: "Total rows",
        missingDays: "Missing trading days",
        missingRatio: "Missing ratio",
        nullClose: "Missing close prices",
        duplicate: "Duplicate timestamps",
        outliers: "Outlier returns",
        maxAbs: "Max absolute return",
      },
      sync: {
        title: "Data Sync (Backfill/Incremental)",
        meta: "Scan path and update coverage.",
        path: "Data path (optional, or stooq:SYMBOL)",
        dateColumn: "Date column",
        errorCreate: "Failed to create sync job",
        errorBatch: "Failed to sync all",
      },
      jobs: {
        title: "Sync Jobs",
        meta: "Total {total} jobs",
        empty: "No sync jobs",
        id: "ID",
        dataset: "Dataset",
        status: "Status",
        rows: "Rows scanned",
        coverage: "Coverage",
        outputs: "Outputs/Archive",
        message: "Message",
        createdAt: "Created At",
        outputLabels: {
          curated: "curated",
          normalized: "normalized",
          adjusted: "adjusted",
          snapshot: "snapshot",
          lean: "lean",
          leanAdjusted: "lean(adj)",
        },
      },
    },
    pagination: {
      prev: "Prev",
      next: "Next",
      page: "Page {page} / {pages}",
      total: "Total {total}",
      range: "Showing {start}-{end}",
      pageSize: "Per page",
    },
    audit: {
      title: "Audit Logs",
      filters: {
        title: "Filters",
        meta: "Supports action / resource_type / resource_id",
        action: "action (backtest.create)",
        resourceType: "resource_type (dataset)",
        resourceId: "resource_id (number)",
      },
      table: {
        id: "ID",
        time: "Time",
        action: "Action",
        resource: "Resource",
        detail: "Details",
        empty: "No audit logs",
      },
    },
  },
};

type I18nContextValue = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
};

const I18nContext = createContext<I18nContextValue>({
  locale: "zh",
  setLocale: () => undefined,
  t: (key) => key,
});

const resolveMessage = (obj: MessageTree, key: string): string | undefined => {
  const parts = key.split(".");
  let current: MessageTree | string | undefined = obj;
  for (const part of parts) {
    if (!current || typeof current === "string") {
      return undefined;
    }
    current = current[part];
  }
  return typeof current === "string" ? current : undefined;
};

const applyVars = (text: string, vars?: Record<string, string | number>): string => {
  if (!vars) {
    return text;
  }
  return text.replace(/\{(\w+)\}/g, (match, key) => {
    if (Object.prototype.hasOwnProperty.call(vars, key)) {
      return String(vars[key]);
    }
    return match;
  });
};

const detectLocale = (): Locale => {
  if (typeof window === "undefined") {
    return "zh";
  }
  const stored = window.localStorage.getItem("locale");
  if (stored === "zh" || stored === "en") {
    return stored;
  }
  const browser = navigator.language.toLowerCase();
  return browser.startsWith("zh") ? "zh" : "en";
};

export const I18nProvider = ({ children }: { children: React.ReactNode }) => {
  const [locale, setLocaleState] = useState<Locale>(detectLocale);
  const setLocale = (next: Locale) => {
    setLocaleState(next);
    if (typeof window !== "undefined") {
      window.localStorage.setItem("locale", next);
    }
  };

  const value = useMemo<I18nContextValue>(() => {
    const t = (key: string, vars?: Record<string, string | number>) => {
      const text = resolveMessage(messages[locale], key) || key;
      return applyVars(text, vars);
    };
    return { locale, setLocale, t };
  }, [locale]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => useContext(I18nContext);
