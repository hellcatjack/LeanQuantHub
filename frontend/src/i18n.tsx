import React, { createContext, useContext, useMemo, useState } from "react";

export type Locale = "zh" | "en";
export type TimeZone = "America/New_York" | "UTC" | "Asia/Shanghai" | "Asia/Hong_Kong";

type MessageTree = Record<string, MessageTree | string>;

const messages: Record<Locale, MessageTree> = {
  zh: {
    nav: {
      projects: "项目",
      themes: "主题",
      algorithms: "算法",
      backtests: "回测",
      reports: "报告",
      data: "数据",
      audit: "审计",
    },
    app: {
      footer: "本地化量化平台 · Lean 引擎",
    },
    topbar: {
      localRunner: "本地执行器",
      leanEngine: "Lean 引擎",
      switchLanguage: "切换语言",
      timezone: "时区",
      timezoneOptions: {
        et: "美国东部时间 (ET)",
        utc: "协调世界时 (UTC)",
        cn: "中国标准时间 (CST)",
        hk: "香港时间 (HKT)",
      },
      localeShort: {
        zh: "中文",
        en: "EN",
      },
    },
    common: {
      none: "-",
      noneText: "无",
      boolean: {
        true: "是",
        false: "否",
      },
      status: {
        queued: "排队中",
        running: "运行中",
        success: "成功",
        failed: "失败",
        ok: "正常",
        warn: "警告",
        rate_limited: "受限",
        not_found: "未覆盖",
      },
      actions: {
        create: "创建",
        save: "保存",
        saved: "已保存",
        saveVersion: "保存版本",
        start: "开始",
        compare: "开始对比",
        generateDiff: "生成 diff",
        run: "运行回测",
        view: "查看",
        download: "下载",
        query: "查询",
        syncAll: "同步全部",
        scan: "执行扫描",
        loadCharts: "加载图表",
        loading: "加载中",
        close: "关闭",
      },
      labels: {
        status: "状态",
        createdAt: "创建时间",
        updatedAt: "更新时间",
        endedAt: "结束时间",
      },
    },
    symbols: {
      types: {
        stock: "股票",
        etf: "ETF",
        adr: "ADR",
        reit: "REITs",
        etn: "ETN",
        fund: "基金",
        index: "指数",
        unknown: "未知",
      },
    },
    metrics: {
      cagr: "复合年化收益率（CAGR）",
      drawdown: "最大回撤",
      drawdownAll: "最大回撤(全程)",
      drawdown52w: "最大回撤(52周)",
      sharpe: "夏普比率",
      netProfit: "净收益",
      totalFees: "总手续费",
      turnover: "组合换手率",
      turnoverWeek: "周换手上限",
      riskStatus: "风控状态",
    },
    charts: {
      noData: "暂无数据",
      pointsSummary: "点数 {count}，起点 {start}，终点 {end}",
      equityCurve: "权益曲线（Strategy Equity）",
      drawdownCurve: "回撤曲线（Drawdown）",
    },
    projects: {
      title: "项目管理",
      new: {
        title: "新建项目",
        meta: "用于组织算法与回测记录",
        name: "项目名称",
        description: "项目描述",
        errorName: "请输入项目名称",
      },
      overview: {
        title: "项目概览",
        meta: "当前项目数量",
      },
      list: {
        title: "项目列表",
        meta: "选择项目进行管理",
        search: "搜索项目名称",
        empty: "暂无项目",
      },
      detail: {
        empty: "请选择项目以查看详情",
        projectId: "项目ID",
        openThemes: "进入主题管理",
        summaryTitle: "项目概览",
        summaryMeta: "核心配置与资产覆盖",
        themeTitle: "主题权重",
        themeMeta: "按权重查看主题分布",
        performanceTitle: "最新回测",
        performanceMeta: "组合与基准关键指标",
      },
      tabs: {
        overview: "概览",
        config: "配置",
        algorithm: "算法",
        data: "数据",
        backtest: "回测",
        versions: "版本",
        diff: "对比",
      },
      table: {
        project: "项目",
        description: "描述",
        createdAt: "创建时间",
      },
      config: {
        title: "项目配置",
        meta: "配置成分范围、数据源与权重",
        universeMode: "成分范围",
        universeHistory: "历史成分（含退市）",
        universeCurrent: "当前成分",
        frequency: "数据周期",
        frequencyDaily: "日线",
        frequencyMinute: "分钟（需付费数据）",
        vendorPrimary: "主数据源",
        vendorFallback: "备数据源",
        benchmark: "基准",
        rebalance: "调仓频率",
        rebalanceDaily: "每日",
        rebalanceWeekly: "每周",
        rebalanceMonthly: "每月",
        rebalanceQuarterly: "每季",
        weights: "主题权重",
        themesTitle: "主题篮子配置",
        themesEmpty: "暂无主题，请先添加",
        themeKey: "主题代码",
        themeLabel: "主题名称",
        themeWeight: "主题权重",
        themePriority: "主题优先级",
        themeKeywords: "关键词（用于筛选，逗号分隔）",
        themeManual: "手动成分（逗号分隔）",
        themeManualShort: "手动成分",
        themeExclude: "排除成分（逗号分隔）",
        themeExcludeShort: "排除成分",
        themeAdd: "添加主题",
        themeRemove: "删除主题",
        themeHint:
          "关键词用于 Yahoo 搜索；手动成分强制纳入；排除优先级最高（自动/手动都会被移除）；重复成分按优先级归属。",
        themeSystem: "系统主题",
        systemThemeTitle: "系统主题库",
        systemThemeMeta: "权威来源的主题篮子，可直接导入项目",
        systemThemeLabel: "主题名称",
        systemThemeSource: "来源",
        systemThemeVersion: "最新版本",
        systemThemeMode: "导入模式",
        systemThemeWeight: "权重",
        systemThemeActions: "操作",
        systemThemeImport: "导入",
        systemThemeReimport: "更新绑定",
        systemThemeRefresh: "更新来源",
        systemThemeEmpty: "暂无系统主题",
        systemThemeError: "系统主题加载失败",
        systemThemeImported: "系统主题已导入并保存",
        systemThemeImportError: "系统主题导入失败",
        systemThemeRefreshSuccess: "系统主题已更新",
        systemThemeRefreshError: "系统主题更新失败",
        systemThemeModeFollow: "跟随更新",
        systemThemeModePin: "固定版本",
        systemThemeModeSnapshot: "快照导入",
        systemThemeReportTitle: "影响报告",
        systemThemeReportMeta: "系统主题更新对项目的影响摘要",
        systemThemeReportEmpty: "暂无影响报告",
        systemThemeReportVersion: "版本变化",
        systemThemeReportDiff: "变更摘要",
        systemThemeReportTime: "生成时间",
        systemThemeReportActions: "操作",
        systemThemeReportExpand: "展开",
        systemThemeReportCollapse: "收起",
        systemThemeReportNone: "无变化",
        systemThemeDiffSymbols: "成分",
        systemThemeDiffKeywords: "关键词",
        systemThemeDiffManual: "手动",
        systemThemeDiffExclude: "排除",
        themeDuplicate: "主题编码重复，请修改后再保存",
        themeActions: "操作",
        themeCount: "主题数量",
        themeSummaryError: "主题构成读取失败",
        themeTotalSymbols: "覆盖成分数",
        themeComposition: "主题构成",
        themeSymbolCount: "成分数量",
        themeSample: "样例成分",
        themeDistribution: "主题分布",
        themeWeightDistribution: "权重分布",
        themeExpand: "展开",
        themeCollapse: "收起",
        themeEmptySymbols: "暂无股票",
        themeView: "查看详情",
        themeClose: "收起详情",
        themeFilter: "主题过滤",
        themeFilterPlaceholder: "按主题名称或编码筛选",
        themeSearchSymbol: "成分筛选",
        themeSearchPlaceholder: "输入证券代码（如 AAPL）",
        themeSearchHint: "按成分筛选主题",
        themeSearchClear: "清除筛选",
        themeSearchEmpty: "请输入证券代码后再筛选",
        themeSearchError: "股票筛选失败",
        themeSearchMatches: "匹配主题 {count} 个",
        themeDetailTitle: "主题详情 · {name}",
        themeDetailMeta: "共 {total} 只成分（手动 {manual} · 排除 {excluded}）",
        themeDetailFilter: "筛选主题内成分（支持代码包含）",
        themeDetailClear: "清除",
        themeDetailExport: "导出列表",
        themeDetailAuto: "自动成分",
        themeDetailManual: "手动成分",
        themeDetailExcluded: "排除成分",
        themeSymbolPlaceholder: "输入股票代码",
        themeSymbolAdd: "加入主题",
        themeSymbolExclude: "从主题中排除",
        themeSymbolExcludeAction: "排除",
        themeSymbolRemove: "移除",
        themeSymbolRestore: "恢复",
        themeSymbolEmpty: "请输入股票代码",
        themeCompareTitle: "主题对比",
        themeCompareA: "主题 A",
        themeCompareB: "主题 B",
        themeCompareEmpty: "请选择主题",
        themeCompareShared: "交集",
        themeCompareOnlyA: "仅主题 A",
        themeCompareOnlyB: "仅主题 B",
        themeCompareError: "主题对比加载失败",
        includeHistory: "包含历史成分",
        assetTypes: "资产类型过滤",
        assetTypesHint: "为空表示不限制；建议仅保留 Stock 以避免 ETF/ADR 混入。",
        pitUniverseOnly: "仅使用 PIT 周度快照股票池",
        pitUniverseOnlyHint: "只从 PIT 周度快照中选股，避免 not_in_pit 过滤。",
        riskFreeRate: "无风险利率",
        backtestStart: "回测起始日期",
        backtestEnd: "回测结束日期",
        backtestRangeHint: "留空表示使用全量历史区间。",
        backtestRangeTitle: "回测区间",
        backtestRangeMeta: "设置回测起止日期，影响下一次回测。",
        sectionUniverse: "成分范围",
        sectionData: "数据源",
        sectionThemes: "主题",
        sectionPortfolio: "组合",
        themeMovedHint: "主题管理已迁移到「主题」页面",
        weightTotal: "权重合计",
        source: "配置来源",
        save: "保存配置",
        saved: "配置已保存",
        error: "保存失败，请检查配置",
      },
      dataStatus: {
        title: "数据状态",
        meta: "S&P500 历史成分与主题数据概况",
        membership: "历史成分数量",
        range: "历史区间",
        universe: "联合成分数量",
        themes: "主题类别数",
        metrics: "指标快照数量",
        prices: "价格文件数量",
        backtestLog: "回测日志路径",
        backtestOutput: "回测输出目录",
        backtestArtifact: "回测归档目录",
        root: "数据根目录",
        action: "刷新数据",
        queued: "已提交数据刷新任务",
        error: "刷新失败，请检查日志",
      },
      algorithm: {
        title: "算法绑定",
        meta: "选择项目使用的算法版本",
        algorithm: "算法",
        version: "算法版本",
        selectAlgorithm: "选择算法",
        selectVersion: "选择版本",
        lock: "锁定算法版本",
        current: "当前绑定",
        save: "保存绑定",
        saved: "算法绑定已保存",
        error: "算法绑定失败",
        errorSelect: "请选择算法与版本",
      },
      strategy: {
        title: "策略来源",
        meta: "选择主题权重 / 基线因子 / ML 分数作为评分来源",
        source: "评分来源",
        sourceTheme: "主题权重",
        sourceFactor: "基线因子",
        sourceMl: "ML 分数",
        scorePath: "评分文件",
        scorePathHint: "例如 ml/models/factor_scores.csv",
        scoreTopN: "TopN",
        scoreWeighting: "权重方式",
        weightScore: "按分数",
        weightEqual: "等权",
        scoreMin: "最低分",
        scoreMaxWeight: "最大权重",
        scoreFallback: "缺失回退",
        fallbackTheme: "回退主题权重",
        fallbackUniverse: "回退全量",
        fallbackSkip: "跳过",
        themeHint: "主题权重模式无需评分文件",
        save: "保存策略",
      },
      factorScores: {
        title: "基线因子打分",
        meta: "基于 PIT 周度快照生成基线因子评分",
        start: "开始日期",
        startHint: "例如 2024-01-01",
        end: "结束日期",
        endHint: "例如 2024-03-31",
        config: "因子配置",
        configHint: "默认 configs/factor_scores.json",
        output: "输出路径",
        outputHint: "默认 ml/models/factor_scores.csv",
        overwrite: "清空缓存后重新计算",
        action: "生成评分",
        queued: "评分任务已提交",
        error: "评分任务失败",
        empty: "暂无任务记录",
        latest: "最新任务",
        scoresPath: "评分文件",
        logPath: "日志路径",
        table: {
          id: "任务 ID",
          status: "状态",
          createdAt: "创建时间",
        },
        status: {
          queued: "排队中",
          running: "运行中",
          success: "成功",
          failed: "失败",
          unknown: "未知",
        },
      },
      ml: {
        title: "模型训练",
        meta: "基于当前项目成分重新训练并生成评分",
        symbolCount: "训练覆盖股票",
        benchmark: "训练基准",
        current: "当前模型",
        currentJob: "训练 #{id}",
        device: "训练设备",
        deviceAuto: "自动",
        deviceCpu: "CPU",
        deviceCuda: "GPU",
        modelType: "模型类型",
        modelTypeTorch: "Torch MLP",
        modelTypeLgbm: "LightGBM 排序",
        modelTypeHint: "LightGBM 需额外依赖，未安装时训练会失败。",
        trainYears: "训练年限",
        trainStartYear: "训练起始年份",
        trainStartYearPlaceholder: "例如 2010",
        trainStartYearHint: "可为空，最早建议 2000（基于 1999-11 数据 + 252 日暖机）。",
        validMonths: "验证月份",
        walkForward: "滚动训练",
        walkForwardHint: "启用后按训练/验证/测试窗口滚动生成评分。",
        testMonths: "测试月份",
        stepMonths: "步长(月)",
        horizonDays: "预测期(天)",
        modelParams: "模型参数(JSON)",
        modelParamsPlaceholder: "例如 {\"num_leaves\": 63, \"learning_rate\": 0.05}",
        modelParamsHint: "可选，覆盖模型默认参数。",
        modelParamsError: "模型参数 JSON 无法解析",
        train: "重新训练",
        cancel: "停止训练",
        canceling: "取消中",
        queued: "训练任务已提交",
        cancelRequested: "已发起取消",
        cancelError: "取消失败",
        activated: "已设为当前模型",
        activateError: "激活失败",
        error: "训练任务失败",
        active: "当前",
        detail: "详情",
        activate: "设为当前",
        empty: "暂无训练记录",
        detailTitle: "训练详情",
        detailStatus: "状态",
        detailModel: "模型类型",
        detailProgress: "训练进度",
        detailPhase: "当前阶段",
        detailWindow: "训练窗口",
        detailEpoch: "训练轮次",
        detailOutput: "输出目录",
        detailScores: "评分文件",
        detailLog: "训练日志",
        detailMessage: "失败原因",
        table: {
          status: "状态",
          progress: "进度",
          window: "窗口",
          range: "训练/验证/测试范围",
          trainRange: "训练",
          trainRangeShort: "训",
          validRange: "验证",
          validRangeShort: "验",
          testRange: "测试",
          testRangeShort: "测",
          model: "模型",
          horizon: "预测期",
          symbols: "覆盖",
          device: "设备",
          createdAt: "创建时间",
          actions: "操作",
        },
        status: {
          queued: "排队中",
          running: "训练中",
          cancel_requested: "取消中",
          canceled: "已取消",
          success: "成功",
          failed: "失败",
          unknown: "未知",
        },
      },
      backtest: {
        title: "项目回测",
        meta: "使用 Lean 引擎运行项目绑定算法",
        defaults: {
          title: "回测默认参数",
          meta: "运行回测时自动应用当前默认参数",
          empty: "暂无默认参数",
          topN: "TopN",
          weighting: "权重方式",
          maxWeight: "单股上限",
          maxExposure: "最大仓位",
          minScore: "最低分",
          marketFilter: "市场过滤",
          marketMa: "市场均线窗口",
          riskOff: "风控模式",
          rebalanceFreq: "调仓频率",
          rebalanceDay: "调仓日",
          rebalanceTime: "调仓时间(分钟)",
          scoreDelay: "分数延迟(日)",
          reloadScores: "刷新评分",
        },
        plugins: {
          title: "策略插件",
          meta: "用于横向对比的回测插件配置",
          scoreDelay: "分数延迟(日)",
          scoreDelayHint: "延后使用评分日期，避免前视",
          scoreSmoothing: "分数平滑",
          scoreSmoothingHint: "EMA 平滑降低噪声",
          scoreSmoothMethod: "平滑方式",
          scoreSmoothEma: "EMA",
          scoreSmoothNone: "无",
          scoreSmoothAlpha: "平滑系数",
          scoreCarry: "沿用缺失评分",
          scoreHysteresis: "持仓缓冲",
          scoreRetain: "保留阈值",
          scoreRetainHint: "大于 TopN 时保留已有持仓",
          weightSmoothing: "权重平滑",
          weightAlpha: "权重平滑系数",
          riskControl: "风险控制",
          riskControlHint: "基于基准均线控制仓位",
          marketMa: "市场均线窗口",
          riskOffMode: "风控模式",
          riskOffCash: "现金",
          riskOffBenchmark: "基准",
          maxExposure: "最大仓位",
          feeBps: "手续费(bps)",
          slippageBps: "滑点(bps)",
          impactBps: "冲击(bps)",
        },
        benchmarkTitle: "基准设置",
        benchmarkMeta: "设置项目回测的对比基准（默认 SPY）",
        action: "运行回测",
        queued: "已提交回测任务",
        empty: "暂无回测结果",
        error: "回测触发失败",
        failed: "回测失败：{message}",
        priceMode: "价格类型",
        benchmarkMode: "基准价格类型",
        pricePolicy: "公司行为口径",
        missingScoresTitle: "缺失清单（{count}）",
        priceAdjusted: "复权",
        priceRaw: "原始",
        priceMixed: "混合",
        policyAdjusted: "复权口径",
        policyRaw: "原始口径",
        metric: "指标",
        portfolio: "组合",
        benchmark: "基准",
        metrics: {
          cagr: "年化收益",
          volatility: "波动率",
          sharpe: "夏普比率",
          maxDrawdown: "最大回撤",
        },
      },
      automation: {
        title: "周度自动化",
        meta: "刷新 PIT 周度快照 → 基本面快照 → 主题回测",
        action: "立即执行",
        running: "执行中",
        queued: "自动化任务已排队",
        empty: "暂无自动化记录",
        error: "自动化触发失败",
        statusLabel: "当前状态",
        pitWeekly: "PIT 周度任务",
        pitWeeklyLog: "PIT 周度日志",
        pitFund: "PIT 基本面任务",
        pitFundLog: "PIT 基本面日志",
        backtest: "回测状态",
        backtestLog: "回测日志",
        backtestOutput: "回测输出",
        backtestArtifact: "回测归档",
        log: "自动化日志",
        status: {
          queued: "排队中",
          running: "运行中",
          success: "成功",
          failed: "失败",
          unknown: "未知",
        },
      },
      versions: {
        title: "版本管理",
        meta: "记录项目描述或关键配置快照",
        emptyProject: "暂无项目",
        version: "版本号 (v0.1)",
        description: "版本说明",
        content: "内容快照（默认使用当前项目描述：{description}）",
        errorSelect: "请先选择项目",
        errorContent: "请填写版本号或内容快照",
      },
      diff: {
        title: "版本对比",
        meta: "选择两个版本生成差异",
        selectFrom: "选择旧版本",
        selectTo: "选择新版本",
        errorSelect: "请选择两个版本进行对比",
        empty: "无差异",
        none: "尚未生成 diff",
      },
      versionsTable: {
        id: "版本 ID",
        version: "版本号",
        summary: "摘要",
        hash: "Hash",
        createdAt: "创建时间",
        empty: "暂无版本记录",
        unnamed: "未命名",
      },
    },
    themes: {
      title: "主题管理",
      project: {
        title: "项目选择",
        meta: "选择项目后管理主题结构与权重",
        select: "当前项目",
        name: "项目名称",
        description: "项目描述",
        configSource: "配置来源",
        empty: "请选择项目后继续",
      },
      config: {
        title: "主题配置",
        meta: "维护主题权重、关键词与手动股票",
      },
      composition: {
        title: "主题构成",
        meta: "查看主题覆盖与股票组成",
      },
      compare: {
        meta: "对比主题交集与差集",
      },
    },
    algorithms: {
      title: "算法管理",
      register: {
        title: "登记算法",
        meta: "用于管理策略版本与执行入口",
        name: "算法名称",
        description: "算法说明",
        language: "语言 (Python/CSharp)",
        version: "版本 (v1.0.0)",
        path: "算法文件路径（/app/stocklean/algorithms/xxx.py）",
        typeName: "C# 类型名（可选）",
        errorName: "请输入算法名称",
      },
      overview: {
        title: "算法概览",
        meta: "当前已登记数量",
      },
      list: {
        title: "算法列表",
        meta: "快速筛选与定位算法",
        search: "搜索算法名称",
        empty: "暂无算法",
      },
      detail: {
        title: "算法详情",
        meta: "编辑基础信息与版本统计",
        latest: "最新版本 #{id}",
        versions: "版本数 {count}",
        name: "算法名称",
        description: "算法说明",
        language: "语言",
        version: "默认版本",
        path: "算法路径",
        typeName: "类型名称",
        empty: "请先选择算法",
        error: "保存失败，请稍后重试",
      },
      tabs: {
        params: "参数",
        versions: "版本",
        diff: "对比",
        project: "项目",
        selftest: "自测",
      },
      selftest: {
        title: "算法自测",
        meta: "使用 Lean 运行回测并与基准对比",
        version: "算法版本",
        benchmark: "基准指数/ETF",
        hint: "推荐基准：SPY、QQQ、VTI、IWM、DIA，可自定义输入",
        action: "发起自测",
        running: "自测运行中...",
        queued: "已提交回测，ID {id}",
        lastRun: "最近回测 ID {id}",
        viewReports: "查看报告",
        error: "回测触发失败",
        failed: "回测失败：{message}",
        errorSelect: "请选择算法版本",
      },
      params: {
        title: "算法参数",
        meta: "周度选股与风控配置",
        cadence: "调仓频率",
        weekly: "每周",
        monthly: "每月",
        market: "市场",
        us: "美股",
        assetClass: "资产类型",
        equity: "股票",
        allowEtf: "允许 ETF",
        coreTitle: "核心股票权重",
        coreSymbols: "核心股票（逗号分隔）",
        coreWeight: "核心权重",
        coreFallback: "缺失时处理",
        cash: "持有现金",
        redistribute: "再分配到核心",
        themeTitle: "主题权重",
        themeKey: "主题代码",
        themeWeight: "权重",
        themeAdd: "添加主题权重",
        themeRemove: "移除",
        themeEmpty: "暂无主题权重，请先添加",
        themeOptionHint: "可输入主题编码或从系统主题模板中选择",
        selectionTitle: "筛选参数",
        topN: "每主题入选数量",
        topMomentum: "动量入选数",
        topLowVol: "低波动入选数",
        minPositions: "最小持仓数",
        trendWeeks: "趋势窗口（周）",
        riskOnWeeks: "风险开关均线（周）",
        lowvolDays: "低波动窗口（天）",
        momShortDays: "短动量窗口（天）",
        momLongDays: "长动量窗口（天）",
        mom12w: "12周动量权重",
        mom4w: "4周动量权重",
        vol20d: "20日波动惩罚",
        blendTitle: "动量/低波动混合",
        momentumWeight: "动量权重",
        lowvolWeight: "低波动权重",
        riskTitle: "风控参数",
        maxWeight: "单股上限",
        volTarget: "目标波动",
        drawdown: "最大回撤阈值",
        inverseVol: "逆波动率加权",
        minVol: "最小波动率",
        themeTilt: "主题权重倾斜",
        defensiveTitle: "防御资产",
        defensiveSymbols: "防御资产（逗号分隔）",
        defensiveHint: "风险关闭时将仓位切换到防御资产",
        advancedTitle: "高级参数",
        advancedHint: "用于复合/低波动策略，按需填写",
        coreEnable: "启用核心股票权重",
        coreDisabledHint: "新建算法默认不使用核心权重，可按需开启",
        modeForm: "结构化参数",
        modeJson: "JSON 参数",
        modeHint: "若算法参数与表单不匹配，可切换到 JSON 模式进行通用配置",
        jsonTitle: "参数 JSON",
        jsonPlaceholder: "{\n  \"selection\": {\n    \"top_n\": 20\n  }\n}",
        jsonHint: "保存版本时将以此 JSON 为准",
        jsonError: "参数 JSON 无效，请检查格式",
        notes: "备注",
        reset: "重置",
        saveVersion: "保存为版本",
      },
      table: {
        name: "名称",
        language: "语言",
        version: "版本",
        path: "路径",
        updatedAt: "更新时间",
      },
      versions: {
        title: "版本管理",
        meta: "为算法登记版本快照并生成对比",
        empty: "暂无算法",
        pick: "选择版本",
        version: "版本号 (v1.0.1)",
        description: "版本说明",
        language: "语言（默认 {language}）",
        typeName: "C# 类型名（可选）",
        filePath: "算法文件路径（留空则使用内容）",
        content: "算法内容（可选，用于生成 diff）",
        errorSelect: "请先选择算法",
        errorContent: "请至少填写版本号、文件路径/内容或参数",
      },
      projectCreate: {
        title: "从算法创建项目",
        meta: "将指定版本作为项目模板",
        name: "项目名称",
        description: "项目描述",
        version: "算法版本",
        lock: "锁定版本",
        action: "创建项目",
        success: "项目已创建并绑定算法",
        error: "创建失败，请检查输入",
        errorSelect: "请选择算法版本",
      },
      diff: {
        title: "版本对比",
        meta: "选择两个版本生成差异",
        selectFrom: "选择旧版本",
        selectTo: "选择新版本",
        errorSelect: "请选择两个版本进行对比",
        empty: "无差异",
        none: "尚未生成 diff",
        unnamed: "未命名",
      },
      versionsTable: {
        id: "版本 ID",
        version: "版本号",
        summary: "摘要",
        hash: "Hash",
        createdAt: "创建时间",
        empty: "暂无版本记录",
      },
    },
    backtests: {
      title: "回测中心",
      tabs: {
        runs: "回测",
        reports: "报告",
      },
      actions: {
        viewCharts: "图表",
        viewTrades: "交易",
      },
      launch: {
        title: "发起回测",
        meta: "填写项目 ID 与参数",
        projectId: "项目 ID",
        params: "参数 JSON",
      },
      table: {
        id: "ID",
        project: "项目",
        status: "状态",
        progress: "进度",
        report: "报告",
        actions: "操作",
        createdAt: "创建时间",
        endedAt: "结束时间",
      },
      preview: {
        title: "回测图表",
        meta: "点击回测记录即可查看收益与交易图表",
        empty: "请选择回测查看图表",
        charts: "收益与回撤",
        trades: "交易图表",
      },
    },
    reports: {
      title: "报告中心",
      latest: {
        title: "最新报告",
        meta: "回测运行后自动归档",
      },
      preview: {
        title: "报告预览",
        meta: "在页面内查看回测 HTML 报告",
        open: "新窗口打开",
        empty: "请选择报告进行预览",
      },
      risk: {
        title: "公司行为风险提示",
        meta:
          "复权与更名映射依赖 map_files/factor_files。缺失时可能导致历史价格断裂或回测误差。",
      },
      compare: {
        title: "回测对比",
        meta: "输入多个回测 ID，快速横向比较关键指标",
        placeholder: "例如：2, 15, 18",
        error: "对比失败",
        empty: "请输入回测 ID（逗号或空格分隔）",
      },
      charts: {
        title: "图表预览",
        meta: "输入回测 ID，加载收益曲线与回撤曲线",
        placeholder: "回测 ID",
        errorNotFound: "未找到结果文件，请确认回测已完成",
        errorLoad: "读取图表失败",
      },
        trades: {
          title: "交易图表",
          meta: "叠加买卖点与行情走势，快速查看交易细节",
          placeholder: "回测 ID",
          symbolPlaceholder: "股票代码",
          load: "加载交易图表",
          loading: "交易数据加载中...",
          error: "交易图表加载失败",
          empty: "暂无交易数据或缺少行情数据",
          buy: "买入",
          buyShort: "买",
          sell: "卖出",
          sellShort: "卖",
          tradesCount: "{count} 笔",
          summary: "买 {buys} / 卖 {sells} · 胜 {wins} / 负 {losses}",
          table: {
            time: "时间",
            side: "方向",
            qty: "数量",
            price: "价格",
          },
        },
      table: {
        id: "ID",
        runId: "回测 ID",
        type: "类型",
        path: "路径",
        actions: "操作",
        createdAt: "生成时间",
      },
    },
    data: {
      title: "数据管理",
      coverage: {
        title: "数据覆盖",
        meta: "数据层更新与质量监控",
      },
      lifecycle: {
        title: "生命周期覆盖",
        meta: "当 delist 与价格历史冲突时，可用覆盖文件修正。",
        source: "默认生命周期文件：",
        override: "覆盖文件：",
        priority: "覆盖优先级高于 Alpha 原始生命周期。",
        config: "权重配置可指定：",
      },
      fetch: {
        title: "历史数据抓取",
        meta: "默认 Alpha，当前仅支持日线历史数据。",
        symbol: "股票代码（如 AAPL）",
        vendor: {
          stooq: "Stooq",
          yahoo: "Yahoo",
          alpha: "Alpha Vantage（默认）",
        },
        stooqOnly: "仅限 Alpha",
        region: {
          us: "美股",
          hk: "港股",
        },
        asset: {
          equity: "股票",
          etf: "ETF",
        },
        frequency: {
          daily: "日线",
          minute: "分钟（暂不支持）",
        },
        preview: "将创建数据集 {dataset} · 来源 {source}",
        action: "抓取历史",
        loading: "抓取中",
        hint: "Alpha 仅支持日线，系统会自动发起数据同步任务",
        errorSymbol: "请填写股票代码",
        errorFrequency: "当前数据源仅支持日线数据",
        error: "历史数据抓取失败",
        successCreated: "已创建数据集 {name}，同步任务 #{jobId} 已排队",
        successQueued: "已复用数据集 {name}，同步任务 #{jobId} 已排队",
        successNoJob: "已准备数据集 {name}",
      },
      list: {
        title: "数据集列表",
        meta: "当前筛选 {totalSymbols} 只股票 / {totalDatasets} 个数据集 · 支持日线/分钟",
        stooqOnly: "仅限 Alpha",
        empty: "暂无数据集",
        filter: {
          label: "周期筛选",
          all: "全部",
          daily: "日线",
          minute: "分钟",
        },
        theme: {
          label: "主题",
          all: "全部主题",
          loading: "加载中",
          error: "主题加载失败",
          coverageTitle: "主题覆盖度 · {theme}",
          coverageMeta: "已覆盖 {covered}/{total} · 缺口 {missing}",
          coverageSample: "缺口样例：{symbols}",
          coverageEmpty: "暂无主题覆盖信息",
          coverageError: "主题覆盖读取失败",
          fetch: "补齐主题成分数据",
          fetching: "补齐中",
          fetchSuccess: "已创建 {created} 个数据集，排队 {queued} 个同步任务",
          fetchError: "补齐失败",
          confirm: "将为主题补齐 {count} 只成分数据，是否继续？",
          noMissing: "主题成分已齐全",
        },
        update: {
          sync: "更新",
          syncing: "更新中",
          syncAll: "全部更新",
          syncingAll: "更新中",
          reset: "全量重跑（清空后重抓）",
          resetConfirm: "将清空本地历史数据并重新抓取，是否继续？",
        },
        chart: {
          show: "图表",
          hide: "收起图表",
        },
        delete: {
          action: "删除",
          deleting: "删除中",
          confirm: "将删除 {symbol} 的全部数据，是否继续？",
          prompt: "请输入 {symbol} 以确认删除",
          mismatch: "输入不匹配，已取消删除",
          error: "删除失败",
        },
        quality: {
          loading: "加载中",
          error: "质量异常",
          incomplete: "不完整",
          days: "天",
          issues: "问题 {count}",
        },
        table: {
          symbol: "Symbol",
          name: "名称",
          periods: "周期/区间",
          frequency: "周期",
          coverage: "覆盖区间",
          updatedAt: "更新时间",
          source: "来源",
          quality: "质量",
          update: "更新",
          actions: "操作",
        },
      },
      bulk: {
        title: "全量抓取（全美股）",
        meta: "基于 Alpha listing 分批建档并入队",
        autoTitle: "一键自动：刷新列表 → 建档入队 → 自动抓取",
        autoAction: "开始一键全量抓取",
        autoLoading: "自动抓取启动中",
        autoHint: "会先刷新全美股 listing，再自动分批建档并启动队列",
        autoNote: "后台可自动续跑，刷新页面可查看进度",
        autoStatus: "任务 #{id} · 状态 {status} · 阶段 {phase}",
        autoCounts: "已建档 {created} · 复用 {reused} · 入队 {queued} · 运行 {running} · 待处理 {pending}",
        auto: {
          batch: "自动批次大小（如 200）",
          delay: "抓取间隔秒（如 0.1）",
        },
        autoError: "自动全量抓取状态读取失败",
        actionError: "操作失败",
        errorDetail: "错误：{detail}",
        statusLabel: {
          queued: "排队",
          running: "运行中",
          paused: "已暂停",
          success: "完成",
          failed: "失败",
          canceled: "已取消",
        },
        phaseLabel: {
          listing_refresh: "刷新列表",
          enqueue: "建档入队",
          syncing: "抓取中",
          done: "完成",
          canceled: "已取消",
          paused: "已暂停",
        },
        actions: {
          pause: "暂停",
          resume: "继续",
          cancel: "取消",
        },
        history: {
          title: "历史任务",
          empty: "暂无历史任务",
          id: "ID",
          status: "状态",
          phase: "阶段",
          progress: "进度",
          counts: "统计",
          error: "错误",
          updatedAt: "更新时间",
          actions: "操作",
          progressValue: "{processed}/{total}",
          countsValue: "建档 {created} · 复用 {reused} · 入队 {queued}",
        },
        step1: "步骤 1：分批建档并入队（不会自动开始抓取）",
        step2: "步骤 2：启动队列开始抓取",
        status: {
          all: "全部",
          active: "仅在市",
          delisted: "仅退市",
        },
        limit: "批次大小（如 200）",
        offset: "起始偏移（如 0）",
        batchHint: "批次大小=每次处理数量；偏移=从第 N 只开始",
        offsetHint: "按“下一批”连续执行，避免重复",
        onlyMissing: "仅创建缺失数据集",
        autoSync: "创建后自动入队同步任务",
        action: "创建并入队",
        loading: "处理中",
        hint: "建议分批执行，完成后用下方队列启动抓取",
        result: "已创建 {created} · 复用 {reused} · 入队 {queued} · 总量 {total} · 下一批 {next}",
        progress: "进度 {processed}/{total}（{percent}%）",
        applyNext: "填入下一批偏移（{next}）",
        error: "全量抓取任务创建失败",
        queueError: "队列启动失败",
        queue: {
          maxJobs: "本次执行任务数（0 为全部）",
          minDelay: "任务间隔秒（如 0.1）",
          hint: "队列按间隔顺序执行，速度受限速与网络影响",
          action: "启动队列",
          loading: "队列启动中",
          result: "{started} · 待处理 {pending}",
          started: "队列已启动",
          already: "队列已在运行",
        },
      },
      pit: {
        title: "PIT 周度快照",
        meta: "周一开盘调仓，快照取上一个交易日收盘",
        start: "开始日期",
        end: "结束日期",
        requireData: "仅包含已抓取行情的股票",
        action: "生成周度快照",
        loading: "生成中",
        note: "输出到 universe/pit_weekly，可用于周度调仓回测",
        latest: "最近任务 #{id} · 状态 {status}",
        calendar: "交易时区 {tz} · 时段 {session}",
        qualityError: "质量报告读取失败",
        quality: {
          snapshots: "快照 {count}",
          symbols: "样本 {count}",
          fixed: "修正 {count}",
          dup: "重复 {count}",
          invalid: "无效 {count}",
          mismatch: "日期异常 {count}",
          life: "生命周期异常 {count}",
          noData: "无数据 {count}",
          updated: "更新 {at}",
        },
        snapshotCount: "快照数 {count}",
        lastSnapshot: "最新快照 {path}",
        output: "输出 {path}",
        log: "日志 {path}",
        historyTitle: "最近任务",
        historyEmpty: "暂无任务",
        loadError: "周度快照任务读取失败",
        error: "周度快照任务创建失败",
        created: "已创建任务 #{id}",
        history: {
          id: "ID",
          status: "状态",
          count: "快照数",
        },
      },
      pitFund: {
        title: "PIT 基本面快照",
        meta: "基于 Alpha 基本面报表构建周度因子快照",
        start: "开始日期",
        end: "结束日期",
        startHint: "仅处理该日期之后的 PIT 周度快照",
        endHint: "仅处理该日期之前的 PIT 周度快照",
        delay: "披露延迟（日）",
        delayHint: "快照日期向前回退的交易日数量",
        minDelay: "抓取间隔（秒）",
        minDelayHint: "每次请求间隔，越小越快但更容易触发限速",
        refresh: "刷新基本面缓存（耗时）",
        refreshHint: "勾选后将强制拉取 Alpha 基本面缓存",
        action: "生成基本面快照",
        loading: "生成中",
        note: "输出到 factors/pit_weekly_fundamentals",
        latest: "最近任务 #{id} · 状态 {status}",
        progressError: "进度读取失败",
        progress: {
          stage: "阶段 {stage}",
          count: "进度 {done}/{total}",
          ok: "成功 {count}",
          partial: "异常 {count}",
          rate: "限流重试 {count}",
          current: "当前 {symbol}",
        },
        snapshotCount: "快照数 {count}",
        lastSnapshot: "最新快照 {path}",
        output: "输出 {path}",
        log: "日志 {path}",
        historyTitle: "最近任务",
        historyEmpty: "暂无任务",
        loadError: "基本面快照任务读取失败",
        error: "基本面快照任务创建失败",
        created: "已创建任务 #{id}",
        history: {
          id: "ID",
          status: "状态",
          count: "快照数",
        },
      },
      frequency: {
        daily: "日线",
        minute: "分钟",
      },
      chart: {
        title: "股票图表",
        meta: "K线与复权对比 · {frequency} · {coverage}",
        mode: {
          both: "对比",
          raw: "原始价格",
          adjusted: "复权价格",
        },
        granularity: {
          auto: "自动",
          day: "日",
          week: "周",
          month: "月",
        },
        range: {
          max: "全部",
        },
        open: "新窗口打开",
        legend: {
          raw: "实际价格（K线）",
          adjusted: "复权价格（折线）",
        },
        loading: "图表加载中...",
        empty: "暂无图表数据",
        error: "图表加载失败",
      },
      register: {
        title: "登记数据集",
        meta: "记录来源、频率与覆盖区间",
        name: "数据集名称",
        vendor: "供应商 (Alpha/自建)",
        frequency: "频率 (daily/minute)",
        asset: "资产类别 (Equity/ETF)",
        region: "区域 (US/HK)",
        start: "覆盖开始 (YYYY-MM-DD)",
        end: "覆盖结束 (YYYY-MM-DD)",
        path: "默认数据路径（DATA_ROOT 内或 alpha:SYMBOL）",
        errorName: "请输入数据集名称",
      },
      table: {
        name: "名称",
        vendor: "供应商",
        frequency: "频率",
        coverage: "覆盖区间",
        path: "路径",
        quality: "质量",
        updatedAt: "更新时间",
      },
      quality: {
        error: "获取质量报告失败",
        title: "质量报告",
        status: "状态",
        coverage: "覆盖区间",
        days: "覆盖天数",
        frequency: "频率",
        expected: "预计数据点",
        points: "数据点",
        minInterval: "最小间隔(天)",
        issues: "问题",
      },
      scan: {
        title: "质量扫描（缺失/异常）",
        meta: "输入 CSV 路径并执行扫描",
        select: "选择数据集",
        errorSelect: "请选择数据集",
        filePath: "CSV 文件路径（位于 DATA_ROOT 内）",
        errorFilePath: "请输入数据文件路径",
        dateColumn: "日期列名",
        closeColumn: "收盘价列名",
        frequency: "频率覆盖 (daily/minute)",
        error: "质量扫描失败",
        result: "扫描结果",
        totalRows: "总行数",
        missingDays: "缺失交易日",
        missingRatio: "缺失比例",
        nullClose: "空收盘价记录",
        duplicate: "重复时间戳",
        outliers: "异常收益数",
        maxAbs: "最大绝对收益",
      },
      sync: {
        title: "数据更新（补齐/增量）",
        meta: "扫描路径并更新覆盖区间",
        path: "数据路径（可留空，或 alpha:SYMBOL）",
        dateColumn: "日期列名",
        errorCreate: "更新任务创建失败",
        errorBatch: "批量更新失败",
      },
      jobs: {
        title: "更新任务",
        meta: "共 {total} 条同步任务",
        speed: "速度 {rate}/min · 最近 {window}s · 运行 {running} · 待处理 {pending}",
        speedEmpty: "速度 -",
        clear: "清理队列",
        clearing: "清理中",
        clearConfirm: "确认清理队列中待处理任务？运行中的任务会继续执行。",
        clearDone: "已清理 {count} 条待处理任务",
        clearError: "清理队列失败",
        empty: "暂无更新任务",
        id: "ID",
        dataset: "数据集",
        status: "状态",
        rows: "扫描行数",
        coverage: "覆盖区间",
        outputs: "输出/归档",
        message: "消息",
        createdAt: "创建时间",
        reason: {
          stooqOnly: "仅 {vendor}",
          rateLimited: "限流",
          premium: "需付费",
          notFound: "未覆盖",
          failed: "失败",
        },
        outputLabels: {
          curated: "curated",
          normalized: "normalized",
          adjusted: "adjusted",
          snapshot: "snapshot",
          lean: "lean",
          leanAdjusted: "lean(adj)",
        },
      },
    },
    pagination: {
      prev: "上一页",
      next: "下一页",
      page: "第 {page} / {pages} 页",
      total: "共 {total} 条",
      range: "显示 {start}-{end}",
      pageSize: "每页",
    },
    audit: {
      title: "审计日志",
      filters: {
        title: "筛选条件",
        meta: "支持 action / resource_type / resource_id",
        action: "action (backtest.create)",
        resourceType: "resource_type (dataset)",
        resourceId: "resource_id (数字)",
      },
      table: {
        id: "ID",
        time: "时间",
        action: "动作",
        resource: "资源",
        detail: "详情",
        empty: "暂无审计记录",
      },
    },
  },
  en: {
    nav: {
      projects: "Projects",
      themes: "Themes",
      algorithms: "Algorithms",
      backtests: "Backtests",
      reports: "Reports",
      data: "Data",
      audit: "Audit Logs",
    },
    app: {
      footer: "Local Quant Platform · Lean Engine",
    },
    topbar: {
      localRunner: "Local Runner",
      leanEngine: "Lean Engine",
      switchLanguage: "Switch Language",
      timezone: "Time Zone",
      timezoneOptions: {
        et: "US Eastern (ET)",
        utc: "UTC",
        cn: "China Standard (CST)",
        hk: "Hong Kong (HKT)",
      },
      localeShort: {
        zh: "中文",
        en: "EN",
      },
    },
    common: {
      none: "-",
      noneText: "None",
      boolean: {
        true: "Yes",
        false: "No",
      },
      status: {
        queued: "Queued",
        running: "Running",
        success: "Success",
        failed: "Failed",
        ok: "OK",
        warn: "Warning",
        rate_limited: "Rate Limited",
        not_found: "Not Found",
      },
      actions: {
        create: "Create",
        save: "Save",
        saved: "Saved",
        saveVersion: "Save Version",
        start: "Start",
        compare: "Compare",
        generateDiff: "Generate Diff",
        run: "Run Backtest",
        view: "View",
        download: "Download",
        query: "Search",
        syncAll: "Sync All",
        scan: "Run Scan",
        loadCharts: "Load Charts",
        loading: "Loading",
        close: "Close",
      },
      labels: {
        status: "Status",
        createdAt: "Created At",
        updatedAt: "Updated At",
        endedAt: "Ended At",
      },
    },
    symbols: {
      types: {
        stock: "Stock",
        etf: "ETF",
        adr: "ADR",
        reit: "REITs",
        etn: "ETN",
        fund: "Fund",
        index: "Index",
        unknown: "Unknown",
      },
    },
    metrics: {
      cagr: "CAGR",
      drawdown: "Max Drawdown",
      drawdownAll: "Max Drawdown (All)",
      drawdown52w: "Max Drawdown (52w)",
      sharpe: "Sharpe Ratio",
      netProfit: "Net Profit",
      totalFees: "Total Fees",
      turnover: "Portfolio Turnover",
      turnoverWeek: "Weekly Turnover Cap",
      riskStatus: "Risk Status",
    },
    charts: {
      noData: "No data available",
      pointsSummary: "Points {count}, start {start}, end {end}",
      equityCurve: "Equity Curve (Strategy Equity)",
      drawdownCurve: "Drawdown Curve (Drawdown)",
    },
    projects: {
      title: "Project Management",
      new: {
        title: "New Project",
        meta: "Organize algorithms and backtest runs.",
        name: "Project Name",
        description: "Project Description",
        errorName: "Project name is required.",
      },
      overview: {
        title: "Project Overview",
        meta: "Total projects",
      },
      list: {
        title: "Project List",
        meta: "Pick a project to manage",
        search: "Search project name",
        empty: "No projects found",
      },
      detail: {
        empty: "Select a project to view details",
        projectId: "Project ID",
        openThemes: "Open Themes",
        summaryTitle: "Project Overview",
        summaryMeta: "Core setup and coverage",
        themeTitle: "Theme Weights",
        themeMeta: "Weight distribution snapshot",
        performanceTitle: "Latest Backtest",
        performanceMeta: "Portfolio vs benchmark key metrics",
      },
      tabs: {
        overview: "Overview",
        config: "Config",
        algorithm: "Algorithm",
        data: "Data",
        backtest: "Backtest",
        versions: "Versions",
        diff: "Diff",
      },
      table: {
        project: "Project",
        description: "Description",
        createdAt: "Created At",
      },
      config: {
        title: "Project Config",
        meta: "Universe scope, data sources, and weights",
        universeMode: "Universe Scope",
        universeHistory: "Historical constituents",
        universeCurrent: "Current constituents",
        frequency: "Data Frequency",
        frequencyDaily: "Daily",
        frequencyMinute: "Minute (paid data)",
        vendorPrimary: "Primary Source",
        vendorFallback: "Fallback Source",
        benchmark: "Benchmark",
        rebalance: "Rebalance Frequency",
        rebalanceDaily: "Daily",
        rebalanceWeekly: "Weekly",
        rebalanceMonthly: "Monthly",
        rebalanceQuarterly: "Quarterly",
        weights: "Theme Weights",
        themesTitle: "Theme Baskets",
        themesEmpty: "No themes yet. Add one to continue.",
        themeKey: "Theme Code",
        themeLabel: "Theme Name",
        themeWeight: "Theme Weight",
        themePriority: "Priority",
        themeKeywords: "Keywords (for screening, comma-separated)",
        themeManual: "Manual Constituents (comma-separated)",
        themeManualShort: "Manual Constituents",
        themeExclude: "Excluded Constituents (comma-separated)",
        themeExcludeShort: "Excluded Constituents",
        themeAdd: "Add Theme",
        themeRemove: "Remove",
        themeHint:
          "Keywords drive Yahoo search; manual constituents are forced; exclusions override auto/manual; overlaps follow priority.",
        themeSystem: "System Theme",
        systemThemeTitle: "System Theme Library",
        systemThemeMeta: "Authoritative theme baskets ready for project import.",
        systemThemeLabel: "Theme",
        systemThemeSource: "Source",
        systemThemeVersion: "Latest Version",
        systemThemeMode: "Import Mode",
        systemThemeWeight: "Weight",
        systemThemeActions: "Actions",
        systemThemeImport: "Import",
        systemThemeReimport: "Update Binding",
        systemThemeRefresh: "Refresh",
        systemThemeEmpty: "No system themes yet",
        systemThemeError: "Failed to load system themes",
        systemThemeImported: "System theme imported and saved",
        systemThemeImportError: "Failed to import system theme",
        systemThemeRefreshSuccess: "System theme refreshed",
        systemThemeRefreshError: "Failed to refresh system theme",
        systemThemeModeFollow: "Follow Latest",
        systemThemeModePin: "Pin Version",
        systemThemeModeSnapshot: "Snapshot",
        systemThemeReportTitle: "Impact Reports",
        systemThemeReportMeta: "Summaries for system theme updates.",
        systemThemeReportEmpty: "No impact reports",
        systemThemeReportVersion: "Version Change",
        systemThemeReportDiff: "Delta",
        systemThemeReportTime: "Created At",
        systemThemeReportActions: "Actions",
        systemThemeReportExpand: "Expand",
        systemThemeReportCollapse: "Collapse",
        systemThemeReportNone: "No changes",
        systemThemeDiffSymbols: "Symbols",
        systemThemeDiffKeywords: "Keywords",
        systemThemeDiffManual: "Manual",
        systemThemeDiffExclude: "Excluded",
        themeDuplicate: "Duplicate theme keys. Please fix before saving.",
        themeActions: "Actions",
        themeCount: "Themes",
        themeSummaryError: "Failed to load theme summary.",
        themeTotalSymbols: "Total Constituents",
        themeComposition: "Theme Composition",
        themeSymbolCount: "Constituents",
        themeSample: "Sample Constituents",
        themeDistribution: "Distribution",
        themeWeightDistribution: "Weight Split",
        themeExpand: "Expand",
        themeCollapse: "Collapse",
        themeEmptySymbols: "No symbols",
        themeView: "View",
        themeClose: "Hide",
        themeFilter: "Theme Filter",
        themeFilterPlaceholder: "Filter by theme name or key",
        themeSearchSymbol: "Constituent Filter",
        themeSearchPlaceholder: "Enter a security symbol (e.g., AAPL)",
        themeSearchHint: "Filter themes by constituent",
        themeSearchClear: "Clear",
        themeSearchEmpty: "Enter a symbol to filter.",
        themeSearchError: "Symbol filter failed.",
        themeSearchMatches: "{count} themes matched",
        themeDetailTitle: "Theme Detail · {name}",
        themeDetailMeta: "{total} constituents (manual {manual} · excluded {excluded})",
        themeDetailFilter: "Filter constituents in theme",
        themeDetailClear: "Clear",
        themeDetailExport: "Export",
        themeDetailAuto: "Auto Constituents",
        themeDetailManual: "Manual Constituents",
        themeDetailExcluded: "Excluded Constituents",
        themeSymbolPlaceholder: "Enter symbol",
        themeSymbolAdd: "Add to Theme",
        themeSymbolExclude: "Exclude from Theme",
        themeSymbolExcludeAction: "Exclude",
        themeSymbolRemove: "Remove",
        themeSymbolRestore: "Restore",
        themeSymbolEmpty: "Please enter a symbol first.",
        themeCompareTitle: "Theme Comparison",
        themeCompareA: "Theme A",
        themeCompareB: "Theme B",
        themeCompareEmpty: "Select a theme",
        themeCompareShared: "Overlap",
        themeCompareOnlyA: "Only A",
        themeCompareOnlyB: "Only B",
        themeCompareError: "Failed to load comparison data.",
        includeHistory: "Include historical constituents",
        assetTypes: "Asset type filter",
        assetTypesHint: "Leave empty for no filter. Prefer Stock to exclude ETFs/ADRs.",
        pitUniverseOnly: "Use PIT weekly universe only",
        pitUniverseOnlyHint: "Limit candidates to PIT weekly snapshots to avoid not_in_pit drops.",
        riskFreeRate: "Risk-free rate",
        backtestStart: "Backtest start date",
        backtestEnd: "Backtest end date",
        backtestRangeHint: "Leave empty to use the full available range.",
        backtestRangeTitle: "Backtest range",
        backtestRangeMeta: "Set the backtest window for the next run.",
        sectionUniverse: "Universe",
        sectionData: "Data",
        sectionThemes: "Themes",
        sectionPortfolio: "Portfolio",
        themeMovedHint: "Theme management moved to the Themes page.",
        weightTotal: "Weight Total",
        source: "Config Source",
        save: "Save Config",
        saved: "Config saved",
        error: "Save failed. Check config.",
      },
      dataStatus: {
        title: "Data Status",
        meta: "S&P500 history and theme coverage",
        membership: "Historical constituents",
        range: "History range",
        universe: "Combined universe",
        themes: "Theme categories",
        metrics: "Metrics snapshots",
        prices: "Price files",
        backtestLog: "Backtest log path",
        backtestOutput: "Backtest output directory",
        backtestArtifact: "Backtest artifact directory",
        root: "Data root",
        action: "Refresh Data",
        queued: "Refresh queued",
        error: "Refresh failed",
      },
      algorithm: {
        title: "Algorithm Binding",
        meta: "Select the algorithm version for this project",
        algorithm: "Algorithm",
        version: "Version",
        selectAlgorithm: "Select algorithm",
        selectVersion: "Select version",
        lock: "Lock algorithm version",
        current: "Current binding",
        save: "Save binding",
        saved: "Binding saved",
        error: "Binding failed",
        errorSelect: "Select algorithm and version",
      },
      strategy: {
        title: "Strategy Source",
        meta: "Choose theme weights / factor baseline / ML scores as the signal source",
        source: "Signal Source",
        sourceTheme: "Theme Weights",
        sourceFactor: "Factor Baseline",
        sourceMl: "ML Scores",
        scorePath: "Score File",
        scorePathHint: "e.g. ml/models/factor_scores.csv",
        scoreTopN: "Top N",
        scoreWeighting: "Weighting",
        weightScore: "Score",
        weightEqual: "Equal",
        scoreMin: "Min Score",
        scoreMaxWeight: "Max Weight",
        scoreFallback: "Fallback",
        fallbackTheme: "Theme Weights",
        fallbackUniverse: "Universe",
        fallbackSkip: "Skip",
        themeHint: "Theme weights mode does not require scores",
        save: "Save Strategy",
      },
      factorScores: {
        title: "Factor Baseline Scores",
        meta: "Generate baseline scores from PIT weekly snapshots",
        start: "Start Date",
        startHint: "e.g. 2024-01-01",
        end: "End Date",
        endHint: "e.g. 2024-03-31",
        config: "Factor Config",
        configHint: "Default configs/factor_scores.json",
        output: "Output Path",
        outputHint: "Default ml/models/factor_scores.csv",
        overwrite: "Rebuild cache",
        action: "Generate Scores",
        queued: "Score job queued",
        error: "Score job failed",
        empty: "No score jobs yet",
        latest: "Latest Job",
        scoresPath: "Score File",
        logPath: "Log Path",
        table: {
          id: "Job ID",
          status: "Status",
          createdAt: "Created At",
        },
        status: {
          queued: "Queued",
          running: "Running",
          success: "Success",
          failed: "Failed",
          unknown: "Unknown",
        },
      },
      ml: {
        title: "Model Training",
        meta: "Retrain scoring model with current project universe",
        symbolCount: "Symbols",
        benchmark: "Benchmark",
        current: "Current Model",
        currentJob: "Job #{id}",
        device: "Device",
        deviceAuto: "Auto",
        deviceCpu: "CPU",
        deviceCuda: "GPU",
        modelType: "Model Type",
        modelTypeTorch: "Torch MLP",
        modelTypeLgbm: "LightGBM Rank",
        modelTypeHint: "LightGBM requires extra dependencies.",
        trainYears: "Train Years",
        trainStartYear: "Training Start Year",
        trainStartYearPlaceholder: "e.g. 2010",
        trainStartYearHint:
          "Optional; earliest recommended is 2000 (1999-11 data + 252-day warmup).",
        validMonths: "Validation Months",
        walkForward: "Walk-Forward",
        walkForwardHint: "Enable rolling train/valid/test windows to generate scores.",
        testMonths: "Test Months",
        stepMonths: "Step Months",
        horizonDays: "Horizon (days)",
        modelParams: "Model Params (JSON)",
        modelParamsPlaceholder: 'e.g. {"num_leaves": 63, "learning_rate": 0.05}',
        modelParamsHint: "Optional, overrides default model parameters.",
        modelParamsError: "Model params JSON is invalid",
        train: "Retrain",
        cancel: "Stop",
        canceling: "Stopping",
        queued: "Training job queued",
        cancelRequested: "Cancel requested",
        cancelError: "Cancel failed",
        activated: "Set as current model",
        activateError: "Activate failed",
        error: "Training failed",
        active: "Active",
        detail: "Detail",
        activate: "Set Current",
        empty: "No training jobs yet",
        detailTitle: "Job Detail",
        detailStatus: "Status",
        detailModel: "Model Type",
        detailProgress: "Progress",
        detailPhase: "Phase",
        detailWindow: "Window",
        detailEpoch: "Epoch",
        detailOutput: "Output Dir",
        detailScores: "Scores",
        detailLog: "Log",
        detailMessage: "Error",
        table: {
          status: "Status",
          progress: "Progress",
          window: "Window",
          range: "Train/Valid/Test Range",
          trainRange: "Train",
          trainRangeShort: "Tr",
          validRange: "Valid",
          validRangeShort: "Val",
          testRange: "Test",
          testRangeShort: "Te",
          model: "Model",
          horizon: "Horizon",
          symbols: "Coverage",
          device: "Device",
          createdAt: "Created At",
          actions: "Actions",
        },
        status: {
          queued: "Queued",
          running: "Running",
          success: "Success",
          failed: "Failed",
          unknown: "Unknown",
        },
      },
      backtest: {
        title: "Project Backtest",
        meta: "Run the project algorithm with Lean",
        defaults: {
          title: "Backtest Defaults",
          meta: "Default parameters applied when running backtests",
          empty: "No defaults configured",
          topN: "Top N",
          weighting: "Weighting",
          maxWeight: "Max Weight",
          maxExposure: "Max Exposure",
          minScore: "Min Score",
          marketFilter: "Market Filter",
          marketMa: "Market MA Window",
          riskOff: "Risk-Off Mode",
          rebalanceFreq: "Rebalance Frequency",
          rebalanceDay: "Rebalance Day",
          rebalanceTime: "Rebalance Minutes",
          scoreDelay: "Score Delay (days)",
          reloadScores: "Reload Scores",
        },
        plugins: {
          title: "Strategy Plugins",
          meta: "Configurable backtest plugins for comparisons",
          scoreDelay: "Score Delay (days)",
          scoreDelayHint: "Delay score usage to avoid look-ahead",
          scoreSmoothing: "Score Smoothing",
          scoreSmoothingHint: "EMA smoothing reduces noise",
          scoreSmoothMethod: "Smoothing Method",
          scoreSmoothEma: "EMA",
          scoreSmoothNone: "None",
          scoreSmoothAlpha: "Smoothing Alpha",
          scoreCarry: "Carry Missing Scores",
          scoreHysteresis: "Holding Buffer",
          scoreRetain: "Retain Threshold",
          scoreRetainHint: "Retain existing holdings above Top N",
          weightSmoothing: "Weight Smoothing",
          weightAlpha: "Weight Smooth Alpha",
          riskControl: "Risk Control",
          riskControlHint: "Use benchmark MA to control exposure",
          marketMa: "Market MA Window",
          riskOffMode: "Risk-Off Mode",
          riskOffCash: "Cash",
          riskOffBenchmark: "Benchmark",
          maxExposure: "Max Exposure",
          feeBps: "Fee (bps)",
          slippageBps: "Slippage (bps)",
          impactBps: "Impact (bps)",
        },
        benchmarkTitle: "Benchmark",
        benchmarkMeta: "Set the benchmark for project backtests (default SPY)",
        action: "Run Backtest",
        queued: "Backtest queued",
        empty: "No backtest result",
        error: "Backtest trigger failed",
        failed: "Backtest failed: {message}",
        priceMode: "Price mode",
        benchmarkMode: "Benchmark price",
        pricePolicy: "Price policy",
        missingScoresTitle: "Missing scores ({count})",
        priceAdjusted: "Adjusted",
        priceRaw: "Raw",
        priceMixed: "Mixed",
        policyAdjusted: "Adjusted",
        policyRaw: "Raw",
        metric: "Metric",
        portfolio: "Portfolio",
        benchmark: "Benchmark",
        metrics: {
          cagr: "CAGR",
          volatility: "Volatility",
          sharpe: "Sharpe",
          maxDrawdown: "Max Drawdown",
        },
      },
      automation: {
        title: "Weekly Automation",
        meta: "Refresh PIT weekly snapshot → fundamentals → thematic backtest",
        action: "Run Now",
        running: "Running",
        queued: "Automation queued",
        empty: "No automation runs yet",
        error: "Automation trigger failed",
        statusLabel: "Status",
        pitWeekly: "PIT Weekly Job",
        pitWeeklyLog: "PIT Weekly Log",
        pitFund: "PIT Fundamental Job",
        pitFundLog: "PIT Fundamental Log",
        backtest: "Backtest Status",
        backtestLog: "Backtest Log",
        backtestOutput: "Backtest Output",
        backtestArtifact: "Backtest Artifact",
        log: "Automation Log",
        status: {
          queued: "Queued",
          running: "Running",
          cancel_requested: "Canceling",
          canceled: "Canceled",
          success: "Success",
          failed: "Failed",
          unknown: "Unknown",
        },
      },
      versions: {
        title: "Version Management",
        meta: "Capture project notes or configuration snapshots.",
        emptyProject: "No projects yet",
        version: "Version (v0.1)",
        description: "Version Notes",
        content: "Content snapshot (default: {description})",
        errorSelect: "Select a project first.",
        errorContent: "Provide a version or content snapshot.",
      },
      diff: {
        title: "Version Diff",
        meta: "Select two versions to compare.",
        selectFrom: "Select base version",
        selectTo: "Select target version",
        errorSelect: "Select two versions to compare.",
        empty: "No differences",
        none: "No diff generated yet",
      },
      versionsTable: {
        id: "Version ID",
        version: "Version",
        summary: "Summary",
        hash: "Hash",
        createdAt: "Created At",
        empty: "No versions yet",
        unnamed: "Unnamed",
      },
    },
    themes: {
      title: "Theme Studio",
      project: {
        title: "Project Scope",
        meta: "Select a project to manage themes",
        select: "Active Project",
        name: "Project Name",
        description: "Description",
        configSource: "Config Source",
        empty: "Select a project to continue",
      },
      config: {
        title: "Theme Configuration",
        meta: "Manage weights, keywords, and manual symbols",
      },
      composition: {
        title: "Theme Composition",
        meta: "Review coverage and constituent symbols",
      },
      compare: {
        meta: "Compare overlaps and deltas",
      },
    },
    algorithms: {
      title: "Algorithm Management",
      register: {
        title: "Register Algorithm",
        meta: "Manage strategy versions and execution entrypoints.",
        name: "Algorithm Name",
        description: "Description",
        language: "Language (Python/CSharp)",
        version: "Version (v1.0.0)",
        path: "Algorithm file path (/app/stocklean/algorithms/xxx.py)",
        typeName: "C# type name (optional)",
        errorName: "Algorithm name is required.",
      },
      overview: {
        title: "Algorithm Overview",
        meta: "Total registered",
      },
      list: {
        title: "Algorithm List",
        meta: "Find and filter algorithms",
        search: "Search algorithm name",
        empty: "No algorithms yet",
      },
      detail: {
        title: "Algorithm Details",
        meta: "Edit metadata and review version stats",
        latest: "Latest #{id}",
        versions: "Versions {count}",
        name: "Algorithm name",
        description: "Description",
        language: "Language",
        version: "Default version",
        path: "File path",
        typeName: "Type name",
        empty: "Select an algorithm first",
        error: "Save failed. Try again.",
      },
      tabs: {
        params: "Parameters",
        versions: "Versions",
        diff: "Diff",
        project: "Project",
        selftest: "Self Test",
      },
      selftest: {
        title: "Algorithm Self Test",
        meta: "Run a Lean backtest and compare against a benchmark",
        version: "Algorithm version",
        benchmark: "Benchmark",
        hint: "Suggested: SPY, QQQ, VTI, IWM, DIA. Custom symbols supported.",
        action: "Run self test",
        running: "Running...",
        queued: "Backtest queued, ID {id}",
        lastRun: "Latest run ID {id}",
        viewReports: "View reports",
        error: "Backtest failed to start",
        errorSelect: "Select an algorithm version",
      },
      params: {
        title: "Algorithm Parameters",
        meta: "Weekly rotation and risk controls",
        cadence: "Rebalance cadence",
        weekly: "Weekly",
        monthly: "Monthly",
        market: "Market",
        us: "US",
        assetClass: "Asset class",
        equity: "Equity",
        allowEtf: "Allow ETFs",
        coreTitle: "Core allocation",
        coreSymbols: "Core symbols (comma separated)",
        coreWeight: "Core weight",
        coreFallback: "Missing handling",
        cash: "Hold cash",
        redistribute: "Redistribute to core",
        themeTitle: "Theme weights",
        themeKey: "Theme key",
        themeWeight: "Weight",
        themeAdd: "Add theme weight",
        themeRemove: "Remove",
        themeEmpty: "No theme weights yet. Add one to begin.",
        themeOptionHint: "Type a theme key or pick from system themes",
        selectionTitle: "Selection parameters",
        topN: "Top N per theme",
        topMomentum: "Top momentum",
        topLowVol: "Top low-vol",
        minPositions: "Minimum positions",
        trendWeeks: "Trend window (weeks)",
        riskOnWeeks: "Risk-on MA (weeks)",
        lowvolDays: "Low-vol window (days)",
        momShortDays: "Short momentum (days)",
        momLongDays: "Long momentum (days)",
        mom12w: "12w momentum weight",
        mom4w: "4w momentum weight",
        vol20d: "20d volatility penalty",
        blendTitle: "Momentum/low-vol blend",
        momentumWeight: "Momentum weight",
        lowvolWeight: "Low-vol weight",
        riskTitle: "Risk controls",
        maxWeight: "Max position",
        volTarget: "Volatility target",
        drawdown: "Drawdown trigger",
        inverseVol: "Inverse volatility weighting",
        minVol: "Minimum volatility",
        themeTilt: "Theme tilt",
        defensiveTitle: "Defensive assets",
        defensiveSymbols: "Defensive symbols (comma-separated)",
        defensiveHint: "Rotate into defensive assets when risk is off",
        advancedTitle: "Advanced parameters",
        advancedHint: "Used by composite/low-vol strategies",
        coreEnable: "Enable core allocation",
        coreDisabledHint: "New algorithms default to no core allocation",
        modeForm: "Structured",
        modeJson: "JSON",
        modeHint: "Use JSON mode for algorithms that don't match the form",
        jsonTitle: "Parameters JSON",
        jsonPlaceholder: "{\n  \"selection\": {\n    \"top_n\": 20\n  }\n}",
        jsonHint: "Version will be saved with the JSON above",
        jsonError: "Invalid JSON parameters",
        notes: "Notes",
        reset: "Reset",
        saveVersion: "Save as version",
      },
      table: {
        name: "Name",
        language: "Language",
        version: "Version",
        path: "Path",
        updatedAt: "Updated At",
      },
      versions: {
        title: "Version Management",
        meta: "Capture algorithm snapshots and diffs.",
        empty: "No algorithms yet",
        pick: "Select a version",
        version: "Version (v1.0.1)",
        description: "Version Notes",
        language: "Language (default {language})",
        typeName: "C# type name (optional)",
        filePath: "Algorithm file path (leave empty to use content)",
        content: "Algorithm content (optional, for diff)",
        errorSelect: "Select an algorithm first.",
        errorContent: "Provide a version, file path/content, or parameters.",
      },
      projectCreate: {
        title: "Create Project",
        meta: "Use a version as a project template.",
        name: "Project name",
        description: "Project description",
        version: "Algorithm version",
        lock: "Lock version",
        action: "Create project",
        success: "Project created and bound",
        error: "Create failed. Check inputs.",
        errorSelect: "Select an algorithm version",
      },
      diff: {
        title: "Version Diff",
        meta: "Select two versions to compare.",
        selectFrom: "Select base version",
        selectTo: "Select target version",
        errorSelect: "Select two versions to compare.",
        empty: "No differences",
        none: "No diff generated yet",
        unnamed: "Unnamed",
      
      actions: {
        viewCharts: "Charts",
        viewTrades: "Trades",
      },
},
      versionsTable: {
        id: "Version ID",
        version: "Version",
        summary: "Summary",
        hash: "Hash",
        createdAt: "Created At",
        empty: "No versions yet",
      },
    },
    backtests: {
      title: "Backtest Center",
      tabs: {
        runs: "Backtests",
        reports: "Reports",
      },
      actions: {
        viewCharts: "Charts",
        viewTrades: "Trades",
      },
      launch: {
        title: "Launch Backtest",
        meta: "Provide project ID and parameters.",
        projectId: "Project ID",
        params: "Parameters JSON",
      },
      table: {
        id: "ID",
        project: "Project",
        status: "Status",
        progress: "Progress",
        report: "Report",
        actions: "Actions",
        createdAt: "Created At",
        endedAt: "Ended At",
      },
      preview: {
        title: "Backtest Charts",
        meta: "Click a backtest to view performance and trade charts.",
        empty: "Select a backtest to view charts.",
        charts: "Equity & Drawdown",
        trades: "Trade Chart",
      },
    },
    reports: {
      title: "Report Center",
      latest: {
        title: "Latest Reports",
        meta: "Auto-archived after backtest runs.",
      },
      preview: {
        title: "Report Preview",
        meta: "View backtest HTML report inline.",
        open: "Open in new tab",
        empty: "Select a report to preview.",
      },
      risk: {
        title: "Corporate Actions Risk",
        meta:
          "Adjustments and ticker mapping rely on map_files/factor_files. Missing data can break price history and distort backtests.",
      },
      compare: {
        title: "Backtest Comparison",
        meta: "Enter multiple backtest IDs to compare key metrics.",
        placeholder: "e.g. 2, 15, 18",
        error: "Comparison failed",
        empty: "Enter backtest IDs (comma or space separated).",
      },
      charts: {
        title: "Chart Preview",
        meta: "Enter a backtest ID to load equity and drawdown curves.",
        placeholder: "Backtest ID",
        errorNotFound: "Result file not found. Ensure the backtest finished.",
        errorLoad: "Failed to load chart data",
      },
        trades: {
          title: "Trade Chart",
          meta: "Overlay fills and price action for quick trade review.",
          placeholder: "Backtest ID",
          symbolPlaceholder: "Symbol",
          load: "Load Trade Chart",
          loading: "Loading trade data...",
          error: "Failed to load trade chart",
          empty: "No trades or missing price data.",
          buy: "Buy",
          buyShort: "B",
          sell: "Sell",
          sellShort: "S",
          tradesCount: "{count} trades",
          summary: "Buy {buys} / Sell {sells} · Win {wins} / Loss {losses}",
          table: {
            time: "Time",
            side: "Side",
            qty: "Qty",
            price: "Price",
          },
        },
      table: {
        id: "ID",
        runId: "Backtest ID",
        type: "Type",
        path: "Path",
        actions: "Actions",
        createdAt: "Created At",
      },
    },
    data: {
      title: "Data Management",
      coverage: {
        title: "Coverage",
        meta: "Data sync and quality monitoring.",
      },
      lifecycle: {
        title: "Lifecycle Overrides",
        meta: "Use overrides when delist dates conflict with price history.",
        source: "Default lifecycle file:",
        override: "Override file:",
        priority: "Overrides take priority over Alpha lifecycle.",
        config: "Override path config:",
      },
      fetch: {
        title: "Fetch History",
        meta: "Default to Alpha. Daily only.",
        symbol: "Symbol (e.g., AAPL)",
        vendor: {
          stooq: "Stooq",
          yahoo: "Yahoo",
          alpha: "Alpha Vantage (default)",
        },
        stooqOnly: "Alpha only",
        region: {
          us: "US",
          hk: "HK",
        },
        asset: {
          equity: "Equity",
          etf: "ETF",
        },
        frequency: {
          daily: "Daily",
          minute: "Minute (unsupported)",
        },
        preview: "Dataset {dataset} · Source {source}",
        action: "Fetch History",
        loading: "Fetching",
        hint: "Alpha supports daily data only; a sync job will be queued.",
        errorSymbol: "Symbol is required.",
        errorFrequency: "Daily data only for the selected vendor.",
        error: "Fetch failed.",
        successCreated: "Created {name}, sync job #{jobId} queued.",
        successQueued: "Reused {name}, sync job #{jobId} queued.",
        successNoJob: "Dataset {name} ready.",
      },
      list: {
        title: "Datasets",
        meta: "Filtered {totalSymbols} symbols / {totalDatasets} datasets · Daily/Minute supported",
        stooqOnly: "Alpha only",
        empty: "No datasets",
        filter: {
          label: "Frequency",
          all: "All",
          daily: "Daily",
          minute: "Minute",
        },
        theme: {
          label: "Theme",
          all: "All Themes",
          loading: "Loading",
          error: "Failed to load themes",
          coverageTitle: "Theme Coverage · {theme}",
          coverageMeta: "{covered}/{total} covered · {missing} missing",
          coverageSample: "Missing sample: {symbols}",
          coverageEmpty: "No theme coverage available",
          coverageError: "Failed to load theme coverage",
          fetch: "Fetch missing constituents",
          fetching: "Filling",
          fetchSuccess: "Created {created} datasets, queued {queued} sync jobs",
          fetchError: "Fill failed",
          confirm: "Fetch {count} missing constituents for this theme?",
          noMissing: "All constituents are covered",
        },
        update: {
          sync: "Sync",
          syncing: "Syncing",
          syncAll: "Sync All",
          syncingAll: "Syncing",
          reset: "Full rerun (clear & refetch)",
          resetConfirm: "This will clear local history and refetch all data. Continue?",
        },
        chart: {
          show: "Chart",
          hide: "Hide Chart",
        },
        delete: {
          action: "Delete",
          deleting: "Deleting",
          confirm: "Delete all data for {symbol}? This cannot be undone.",
          prompt: "Type {symbol} to confirm deletion",
          mismatch: "Input does not match. Deletion cancelled.",
          error: "Delete failed",
        },
        quality: {
          loading: "Loading",
          error: "Quality error",
          incomplete: "Incomplete",
          days: "d",
          issues: "Issues {count}",
        },
        table: {
          symbol: "Symbol",
          name: "Name",
          periods: "Periods",
          frequency: "Frequency",
          coverage: "Coverage",
          updatedAt: "Updated",
          source: "Source",
          quality: "Quality",
          update: "Update",
          actions: "Actions",
        },
      },
      bulk: {
        title: "Bulk Fetch (All US)",
        meta: "Batch create datasets from Alpha listing and enqueue sync jobs",
        autoTitle: "One-click: refresh listing → enqueue → auto fetch",
        autoAction: "Start One-click Bulk Fetch",
        autoLoading: "Starting bulk fetch",
        autoHint: "Refreshes listing, batches datasets, then starts the queue",
        autoNote: "Runs in background; refresh to see progress",
        autoStatus: "Job #{id} · status {status} · phase {phase}",
        autoCounts: "Created {created} · Reused {reused} · Queued {queued} · Running {running} · Pending {pending}",
        auto: {
          batch: "Auto batch size (e.g., 200)",
          delay: "Fetch delay seconds (e.g., 0.1)",
        },
        autoError: "Failed to load bulk sync status",
        actionError: "Action failed",
        errorDetail: "Error: {detail}",
        statusLabel: {
          queued: "Queued",
          running: "Running",
          paused: "Paused",
          success: "Success",
          failed: "Failed",
          canceled: "Canceled",
        },
        phaseLabel: {
          listing_refresh: "Listing refresh",
          enqueue: "Enqueue",
          syncing: "Syncing",
          done: "Done",
          canceled: "Canceled",
          paused: "Paused",
        },
        actions: {
          pause: "Pause",
          resume: "Resume",
          cancel: "Cancel",
        },
        history: {
          title: "History",
          empty: "No history",
          id: "ID",
          status: "Status",
          phase: "Phase",
          progress: "Progress",
          counts: "Counts",
          error: "Error",
          updatedAt: "Updated",
          actions: "Actions",
          progressValue: "{processed}/{total}",
          countsValue: "Created {created} · Reused {reused} · Queued {queued}",
        },
        step1: "Step 1: batch create + enqueue (no auto fetch)",
        step2: "Step 2: start the queue to fetch",
        status: {
          all: "All",
          active: "Active only",
          delisted: "Delisted only",
        },
        limit: "Batch size (e.g., 200)",
        offset: "Offset (e.g., 0)",
        batchHint: "Batch size = symbols per run; Offset = start index",
        offsetHint: "Use the next offset to avoid duplicates",
        onlyMissing: "Only create missing datasets",
        autoSync: "Auto enqueue sync jobs",
        action: "Create & Enqueue",
        loading: "Working",
        hint: "Run in batches, then start the queue below",
        result: "Created {created} · Reused {reused} · Queued {queued} · Total {total} · Next {next}",
        progress: "Progress {processed}/{total} ({percent}%)",
        applyNext: "Apply next offset ({next})",
        error: "Failed to create bulk fetch jobs",
        queueError: "Failed to start queue",
        queue: {
          maxJobs: "Jobs this run (0 = all)",
          minDelay: "Delay between jobs (e.g., 0.1s)",
          hint: "Queue runs sequentially; speed depends on rate limits",
          action: "Start Queue",
          loading: "Starting queue",
          result: "{started} · Pending {pending}",
          started: "Queue started",
          already: "Queue already running",
        },
      },
      pit: {
        title: "PIT Weekly Snapshots",
        meta: "Rebalance on week open, snapshot previous trading close",
        start: "Start date",
        end: "End date",
        requireData: "Only include symbols with data",
        action: "Generate weekly snapshots",
        loading: "Generating",
        note: "Outputs to universe/pit_weekly for weekly rebalancing",
        latest: "Latest job #{id} · status {status}",
        calendar: "Timezone {tz} · Session {session}",
        qualityError: "Failed to load quality report",
        quality: {
          snapshots: "Snapshots {count}",
          symbols: "Symbols {count}",
          fixed: "Fixed {count}",
          dup: "Duplicates {count}",
          invalid: "Invalid {count}",
          mismatch: "Date mismatch {count}",
          life: "Out of life {count}",
          noData: "No data {count}",
          updated: "Updated {at}",
        },
        snapshotCount: "Snapshots {count}",
        lastSnapshot: "Latest snapshot {path}",
        output: "Output {path}",
        log: "Log {path}",
        historyTitle: "Recent jobs",
        historyEmpty: "No jobs yet",
        loadError: "Failed to load PIT weekly jobs",
        error: "Failed to create PIT weekly job",
        created: "Created job #{id}",
        history: {
          id: "ID",
          status: "Status",
          count: "Snapshots",
        },
      },
      pitFund: {
        title: "PIT Fundamental Snapshots",
        meta: "Build weekly factor snapshots from Alpha fundamentals",
        start: "Start date",
        end: "End date",
        startHint: "Only process PIT weekly snapshots after this date",
        endHint: "Only process PIT weekly snapshots before this date",
        delay: "Report delay (days)",
        delayHint: "Trading-day lookback for report availability",
        minDelay: "Fetch delay (seconds)",
        minDelayHint: "Delay per request; lower is faster but hits rate limits",
        refresh: "Refresh fundamentals cache (slow)",
        refreshHint: "Force refresh Alpha fundamentals cache",
        action: "Generate fundamental snapshots",
        loading: "Generating",
        note: "Outputs to factors/pit_weekly_fundamentals",
        latest: "Latest job #{id} · status {status}",
        progressError: "Progress load failed",
        progress: {
          stage: "Stage {stage}",
          count: "Progress {done}/{total}",
          ok: "OK {count}",
          partial: "Partial {count}",
          rate: "Rate-limited {count}",
          current: "Current {symbol}",
        },
        snapshotCount: "Snapshots {count}",
        lastSnapshot: "Latest snapshot {path}",
        output: "Output {path}",
        log: "Log {path}",
        historyTitle: "Recent jobs",
        historyEmpty: "No jobs yet",
        loadError: "Failed to load fundamental snapshot jobs",
        error: "Failed to create fundamental snapshot job",
        created: "Created job #{id}",
        history: {
          id: "ID",
          status: "Status",
          count: "Snapshots",
        },
      },
      frequency: {
        daily: "Daily",
        minute: "Minute",
      },
      chart: {
        title: "Dataset Chart",
        meta: "Candles vs Adjusted · {frequency} · {coverage}",
        mode: {
          both: "Compare",
          raw: "Raw",
          adjusted: "Adjusted",
        },
        granularity: {
          auto: "Auto",
          day: "Day",
          week: "Week",
          month: "Month",
        },
        range: {
          max: "Max",
        },
        open: "Open in new tab",
        legend: {
          raw: "Raw price (candles)",
          adjusted: "Adjusted price (line)",
        },
        loading: "Loading chart...",
        empty: "No chart data",
        error: "Failed to load chart",
      },
      register: {
        title: "Register Dataset",
        meta: "Record source, frequency, and coverage window.",
        name: "Dataset Name",
        vendor: "Vendor (Alpha/Custom)",
        frequency: "Frequency (daily/minute)",
        asset: "Asset Class (Equity/ETF)",
        region: "Region (US/HK)",
        start: "Coverage Start (YYYY-MM-DD)",
        end: "Coverage End (YYYY-MM-DD)",
        path: "Default data path (under DATA_ROOT or alpha:SYMBOL)",
        errorName: "Dataset name is required.",
      },
      table: {
        name: "Name",
        vendor: "Vendor",
        frequency: "Frequency",
        coverage: "Coverage",
        path: "Path",
        quality: "Quality",
        updatedAt: "Updated At",
      },
      quality: {
        error: "Failed to fetch quality report",
        title: "Quality Report",
        status: "Status",
        coverage: "Coverage",
        days: "Coverage Days",
        frequency: "Frequency",
        expected: "Expected Points",
        points: "Data Points",
        minInterval: "Min Interval (days)",
        issues: "Issues",
      },
      scan: {
        title: "Quality Scan (Missing/Anomalies)",
        meta: "Provide a CSV path and run scan.",
        select: "Select Dataset",
        errorSelect: "Select a dataset.",
        filePath: "CSV file path (under DATA_ROOT)",
        errorFilePath: "Provide a data file path.",
        dateColumn: "Date column",
        closeColumn: "Close column",
        frequency: "Frequency (daily/minute)",
        error: "Quality scan failed",
        result: "Scan Results",
        totalRows: "Total rows",
        missingDays: "Missing trading days",
        missingRatio: "Missing ratio",
        nullClose: "Missing close prices",
        duplicate: "Duplicate timestamps",
        outliers: "Outlier returns",
        maxAbs: "Max absolute return",
      },
      sync: {
        title: "Data Sync (Backfill/Incremental)",
        meta: "Scan path and update coverage.",
        path: "Data path (optional, or alpha:SYMBOL)",
        dateColumn: "Date column",
        errorCreate: "Failed to create sync job",
        errorBatch: "Failed to sync all",
      },
      jobs: {
        title: "Sync Jobs",
        meta: "Total {total} jobs",
        speed: "Rate {rate}/min · last {window}s · running {running} · pending {pending}",
        speedEmpty: "Rate -",
        clear: "Clear Queue",
        clearing: "Clearing",
        clearConfirm: "Clear queued sync jobs? Running jobs will continue.",
        clearDone: "Cleared {count} queued jobs",
        clearError: "Failed to clear queue",
        empty: "No sync jobs",
        id: "ID",
        dataset: "Dataset",
        status: "Status",
        rows: "Rows scanned",
        coverage: "Coverage",
        outputs: "Outputs/Archive",
        message: "Message",
        createdAt: "Created At",
        reason: {
          stooqOnly: "Only {vendor}",
          rateLimited: "Rate limited",
          premium: "Premium required",
          notFound: "Not found",
          failed: "Failed",
        },
        outputLabels: {
          curated: "curated",
          normalized: "normalized",
          adjusted: "adjusted",
          snapshot: "snapshot",
          lean: "lean",
          leanAdjusted: "lean(adj)",
        },
      },
    },
    pagination: {
      prev: "Prev",
      next: "Next",
      page: "Page {page} / {pages}",
      total: "Total {total}",
      range: "Showing {start}-{end}",
      pageSize: "Per page",
    },
    audit: {
      title: "Audit Logs",
      filters: {
        title: "Filters",
        meta: "Supports action / resource_type / resource_id",
        action: "action (backtest.create)",
        resourceType: "resource_type (dataset)",
        resourceId: "resource_id (number)",
      },
      table: {
        id: "ID",
        time: "Time",
        action: "Action",
        resource: "Resource",
        detail: "Details",
        empty: "No audit logs",
      },
    },
  },
};

type I18nContextValue = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  timeZone: TimeZone;
  setTimeZone: (zone: TimeZone) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
  formatDateTime: (value?: string | number | Date | null) => string;
};

const I18nContext = createContext<I18nContextValue>({
  locale: "zh",
  setLocale: () => undefined,
  timeZone: "America/New_York",
  setTimeZone: () => undefined,
  t: (key) => key,
  formatDateTime: (value) => String(value ?? ""),
});

const resolveMessage = (obj: MessageTree, key: string): string | undefined => {
  const parts = key.split(".");
  let current: MessageTree | string | undefined = obj;
  for (const part of parts) {
    if (!current || typeof current === "string") {
      return undefined;
    }
    current = current[part];
  }
  return typeof current === "string" ? current : undefined;
};

const applyVars = (text: string, vars?: Record<string, string | number>): string => {
  if (!vars) {
    return text;
  }
  return text.replace(/\{(\w+)\}/g, (match, key) => {
    if (Object.prototype.hasOwnProperty.call(vars, key)) {
      return String(vars[key]);
    }
    return match;
  });
};

const detectLocale = (): Locale => {
  if (typeof window === "undefined") {
    return "zh";
  }
  const stored = window.localStorage.getItem("locale");
  if (stored === "zh" || stored === "en") {
    return stored;
  }
  const browser = navigator.language.toLowerCase();
  return browser.startsWith("zh") ? "zh" : "en";
};

const TIMEZONE_STORAGE_KEY = "timezone";
const DEFAULT_TIMEZONE: TimeZone = "America/New_York";
const TIMEZONE_OPTIONS: TimeZone[] = [
  "America/New_York",
  "UTC",
  "Asia/Shanghai",
  "Asia/Hong_Kong",
];

const detectTimeZone = (): TimeZone => {
  if (typeof window === "undefined") {
    return DEFAULT_TIMEZONE;
  }
  const stored = window.localStorage.getItem(TIMEZONE_STORAGE_KEY);
  if (stored && TIMEZONE_OPTIONS.includes(stored as TimeZone)) {
    return stored as TimeZone;
  }
  return DEFAULT_TIMEZONE;
};

export const I18nProvider = ({ children }: { children: React.ReactNode }) => {
  const [locale, setLocaleState] = useState<Locale>(detectLocale);
  const [timeZone, setTimeZoneState] = useState<TimeZone>(detectTimeZone);
  const setLocale = (next: Locale) => {
    setLocaleState(next);
    if (typeof window !== "undefined") {
      window.localStorage.setItem("locale", next);
    }
  };
  const setTimeZone = (next: TimeZone) => {
    setTimeZoneState(next);
    if (typeof window !== "undefined") {
      window.localStorage.setItem(TIMEZONE_STORAGE_KEY, next);
    }
  };

  const value = useMemo<I18nContextValue>(() => {
    const t = (key: string, vars?: Record<string, string | number>) => {
      const text = resolveMessage(messages[locale], key) || key;
      return applyVars(text, vars);
    };
    const formatDateTime = (value?: string | number | Date | null) => {
      if (!value) {
        return t("common.none");
      }
      const normalizeDate = () => {
        if (value instanceof Date) {
          return value;
        }
        if (typeof value === "number") {
          return new Date(value);
        }
        if (typeof value === "string") {
          const trimmed = value.trim();
          if (!trimmed) {
            return null;
          }
          const hasTimeZone = /[zZ]|[+-]\d{2}:?\d{2}$/.test(trimmed);
          const hasTime = /T|\d{2}:\d{2}/.test(trimmed);
          if (!hasTimeZone && hasTime) {
            return new Date(`${trimmed}Z`);
          }
          return new Date(trimmed);
        }
        return null;
      };
      const date = normalizeDate();
      if (!date || Number.isNaN(date.getTime())) {
        return t("common.none");
      }
      const localeTag = locale === "zh" ? "zh-CN" : "en-US";
      try {
        return new Intl.DateTimeFormat(localeTag, {
          timeZone,
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        }).format(date);
      } catch (err) {
        return date.toLocaleString(localeTag, { timeZone });
      }
    };
    return { locale, setLocale, timeZone, setTimeZone, t, formatDateTime };
  }, [locale, timeZone]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => useContext(I18nContext);
