# PreTrade 周度检查并发防护设计

## 背景与问题
PreTrade 周度检查在已有运行实例时继续发起会返回 409，前端仅展示通用失败提示，用户难以理解“为什么不能启动”。同时按钮未禁用，容易重复点击造成困惑。需要在 UI 侧明确告知“已有运行中的批次”，并在交互上避免无意义的重复提交。

## 目标
1) 当存在运行中的批次时，禁止再次发起并在 UI 显示明确提示；2) 若因时序问题触发 409，也能给出清晰信息；3) 不增加后端负担，避免额外接口依赖；4) 保持现有 PreTrade 流程与页面结构不变，最小化改动。

## 方案选项
方案 A：仅在捕获 409 时显示提示，不做按钮禁用。优点是改动小；缺点是用户仍可能反复点击并触发请求。  
方案 B：基于现有运行列表判断“活动批次”，禁用按钮并显示提示，同时 409 兜底。优点是交互清晰、请求最小；缺点是依赖运行列表数据及时性。  
方案 C：新增后端 summary 接口用于前端判断。优点是更准确；缺点是新增依赖与接口调用。

## 推荐方案
采用方案 B。原因：前端已有运行列表数据，能覆盖大部分场景；并保留 409 兜底，处理并发/时序问题。无需新增接口，风险最低。

## 交互与数据流
前端从运行列表中识别“queued/running”的活动批次：  
1) 若存在活动批次，禁用“开始运行”按钮，显示“已有运行中的 checklist（#id）”。  
2) 用户仍可刷新运行列表查看进度。  
3) 若点击仍发生 409，展示同样提示作为兜底。

## 错误处理
对 409 返回提供专用文案；对其他错误保持原有提示。提示文案包含批次 ID（可用时），无法确定则使用通用提示。

## 测试计划
1) 单元测试：验证活动状态识别逻辑；  
2) UI 手工验证：存在运行中的批次时按钮禁用且提示显示；无运行时可正常发起；  
3) 409 兜底验证：模拟 409 时提示正确显示。
