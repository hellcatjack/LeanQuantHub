# 实盘交易-项目绑定与执行设计

## 背景
实盘交易页需要“显式绑定项目 + 当日决策快照”以确保交易执行与回测/信号一致，并符合单实例与可审计要求。

## 目标
- 明确绑定项目，执行只基于该项目当日决策快照。
- 快照缺失时不可执行，并引导生成。
- 执行前展示模式/心跳等关键上下文，降低误操作风险。

## 非目标
- 不在前端生成订单；订单意图仍由后端/Lean 执行器处理。
- 不改变决策快照生成逻辑，仅调用与展示。

## 交互与绑定流程
1. 页面顶部新增“项目绑定”区域：项目搜索下拉（支持 ID/名称）。
2. 选择项目后自动拉取“当日决策快照”信息：日期、版本、权重数、状态。
3. 若未生成快照：显示提示“未生成快照，无法执行”，并提供“生成快照/跳转模型决策”入口。
4. 执行按钮显示绑定上下文（项目名 + 快照日期 + 版本），切换项目时清空执行表单与历史选择。

## 数据一致性与安全
- 执行以 `project_id + snapshot_id` 为唯一上下文；UI 不允许跨项目执行。
- 快照状态为“缺失/未冻结/过期”时，执行按钮置灰。
- 执行前展示：Paper/Live、Bridge 心跳状态（来源 Lean bridge）。

## 文案与提示
- 未选择项目：提示“请选择项目后执行”。
- 无快照：提示“当日快照未生成，无法执行”。
- 快照可用：展示“快照日期/版本/权重条目数”。

## 测试策略（TDD）
- Playwright：未选择项目 → 执行按钮禁用。
- Playwright：选择项目但无快照 → 提示可见，按钮禁用。
- Playwright：选择项目且有快照 → 按钮可用并显示快照信息。

## 风险与权衡
- 绑定流程增加一步，但可显著降低误下单风险。
- 快照生成依赖模型流程，需保障链路稳定。
