# 回测目标(0.12)推进清单

## 目标约束
- MaxDD_all ≤ 0.12
- MaxDD_52w ≤ 0.12
- CAGR ≥ 0.10
- Turnover_week ≤ 0.08

## 最新回测汇总(项目16, 并发8组)
| ID | 组合标签 | MaxDD_all | MaxDD_52w | CAGR | Sharpe | Turnover_week |
| --- | --- | --- | --- | --- | --- | --- |
| 126 | A_expo0.6_vol0.10_ma200 | 28.82% | 28.82% | 31.68% | 1.085 | 8.00% |
| 127 | F_expo0.6_vol0.10_ma250 | 28.82% | 28.82% | 31.68% | 1.085 | 8.00% |
| 128 | C_expo0.6_vol0.08_ma200 | 28.82% | 28.82% | 31.68% | 1.085 | 8.00% |
| 129 | G_expo0.6_vol0.10_no_ma | 28.97% | 28.97% | 31.68% | 1.092 | 8.00% |
| 130 | D_expo0.5_vol0.08_ma200 | 24.73% | 24.73% | 26.15% | 1.045 | 8.00% |
| 131 | E_expo0.6_vol0.10_ma150 | 28.82% | 28.82% | 31.68% | 1.085 | 8.00% |
| 132 | B_expo0.5_vol0.10_ma200 | 24.73% | 24.73% | 26.15% | 1.045 | 8.00% |
| 133 | H_expo0.4_vol0.08_ma200 | 19.29% | 19.29% | 19.96% | 0.999 | 8.00% |

## 关键结论
- 当前最好的回撤仍为 19.29%，与目标 12% 差距明显。
- 多组参数(0.6 曝光 / 不同 MA / 不同 vol_target)结果一致，说明市场过滤或波动率目标对结果影响极小，可能未触发或未生效。
- Turnover_week 恒定在 8.00%，说明换手率上限生效，但没有进一步降低回撤。
- 仅靠风险资产→防御资产(单一 SHY)不足以压到 12% 回撤。

## 主要假设/待验证点
1. 回撤门控实际触发频率是否低于预期(可能未触发或触发后未持续生效)。
2. 波动率目标(vol_target)可能未生效(History 取数、VolScale 计算或权重缩放逻辑需验证)。
3. MA 过滤可能因区间行情未触发，或 SMA 准备/更新逻辑存在偏差。

## 新回测 TODO (按优先级)
1. 观测与诊断
   - 在算法中记录: DD_Locked, DD_TriggerDate, DD_TriggerValue, VolScale, RiskOffMode。
   - 出现 drawdown 触发时强制写入日志，验证是否持续锁定。
   - 记录 SMA 当前值与触发次数，确认 market_filter 生效。

2. 回撤门控强化
   - 增加分层风险控制：
     - DD ≥ 0.08: 降低目标曝光(例如 0.5→0.3)
     - DD ≥ 0.10: 进一步降低(0.3→0.2)
     - DD ≥ 0.12: 全部切到防御资产
   - 恢复条件采用恢复比率(例如 0.8~0.9)并保持锁定期。

3. 防御资产升级
   - 引入防御篮子(如 SHY/IEF/GLD/TLT)，风险关停时择强或等权。
   - 参数化防御资产池与选择方式(相对动量/波动率最小)。

4. 降低策略整体风险暴露
   - 回测新增组合：max_exposure 0.3 / 0.25 / 0.2。
   - top_n 缩小到 10 或 12，max_weight 降到 0.03。

5. 波动率目标生效验证
   - 验证 VolScale 是否持续 <1；若恒为 1，修正 History 取数与索引逻辑。
   - 若 vol_target 生效后仍回撤偏高，进一步降低 vol_target (0.06~0.08)。

6. 回测批次计划(下一轮)
   - 先验证 "回撤门控 + 防御篮子" 是否能将 MaxDD 压到 0.12。
   - 若达标，再逐步回升 CAGR (提高 exposure 或加权优化)。

## 预期目标
- 先达成 MaxDD_all / MaxDD_52w ≤ 0.12，再优化 CAGR ≥ 0.10。
- 若回撤仍偏高，优先调整风险控制，而非继续提高收益目标。
